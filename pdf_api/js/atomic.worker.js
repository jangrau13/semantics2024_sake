/*! For license information please see main.js.LICENSE.txt */
(()=>{var t,e,r,o,n={945:function(t,e){var r="undefined"!=typeof self?self:this,o=function(){function t(){this.fetch=!1,this.DOMException=r.DOMException}return t.prototype=r,new t}();!function(t){!function(e){var r="URLSearchParams"in t,o="Symbol"in t&&"iterator"in Symbol,n="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,s="ArrayBuffer"in t;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function l(t){return"string"!=typeof t&&(t=String(t)),t}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return o&&(e[Symbol.iterator]=function(){return e}),e}function h(t){this.map={},t instanceof h?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function d(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function f(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function y(t){var e=new FileReader,r=f(e);return e.readAsArrayBuffer(t),r}function m(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:n&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:i&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&n&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=m(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||c(t))?this._bodyArrayBuffer=m(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var t=d(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t,e,r,o=d(this);if(o)return o;if(this._bodyBlob)return t=this._bodyBlob,r=f(e=new FileReader),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),o=0;o<e.length;o++)r[o]=String.fromCharCode(e[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(t,e){t=u(t),e=l(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},h.prototype.delete=function(t){delete this.map[u(t)]},h.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},h.prototype.set=function(t,e){this.map[u(t)]=l(e)},h.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},h.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),p(t)},h.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),p(t)},h.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),p(t)},o&&(h.prototype[Symbol.iterator]=h.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(t,e){var r,o,n=(e=e||{}).body;if(t instanceof g){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(o=(r=e.method||this.method||"GET").toUpperCase(),b.indexOf(o)>-1?o:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function w(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}})),e}function S(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},v.call(g.prototype),v.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},S.error=function(){var t=new S(null,{status:0,statusText:""});return t.type="error",t};var x=[301,302,303,307,308];S.redirect=function(t,e){if(-1===x.indexOf(e))throw new RangeError("Invalid status code");return new S(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function A(t,r){return new Promise((function(o,i){var s=new g(t,r);if(s.signal&&s.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),o=r.shift().trim();if(o){var n=r.join(":").trim();e.append(o,n)}})),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;o(new S(n,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&n&&(a.responseType="blob"),s.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),s.signal&&(s.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",c)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}A.polyfill=!0,t.fetch||(t.fetch=A,t.Headers=h,t.Request=g,t.Response=S),e.Headers=h,e.Request=g,e.Response=S,e.fetch=A,Object.defineProperty(e,"__esModule",{value:!0})}({})}(o),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var n=o;(e=n.fetch).default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e},492:t=>{"use strict";t.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var r,o="boolean"==typeof e.cycles&&e.cycles,n=e.cmp&&(r=e.cmp,function(t){return function(e,o){var n={key:e,value:t[e]},i={key:o,value:t[o]};return r(n,i)}}),i=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var r,s;if(Array.isArray(e)){for(s="[",r=0;r<e.length;r++)r&&(s+=","),s+=t(e[r])||"null";return s+"]"}if(null===e)return"null";if(-1!==i.indexOf(e)){if(o)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=i.push(e)-1,c=Object.keys(e).sort(n&&n(e));for(s="",r=0;r<c.length;r++){var u=c[r],l=t(e[u]);l&&(s&&(s+=","),s+=JSON.stringify(u)+":"+l)}return i.splice(a,1),"{"+s+"}"}}(t)}},122:()=>{},105:(t,e,r)=>{"use strict";r.a(t,(async(t,e)=>{try{var o=r(516);const n=new o.il,i=new o.g6("G3u3xjPMjecRCQ6eE/TBw8UKaKqUZDbFb0pndU30Bw8=","https://wiser-atomic.tunnelto.dev/agents/LwgknNqeuvB6vVwjg1qtMgoqezce9nLh4RId5GKlQa4=");function s(){let t="#";for(let e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}async function a(){const t=(await n.getResourceAsync("https://wiser-atomic.tunnelto.dev/collections/ontology/concept")).get("https://atomicdata.dev/properties/classes");let e=[];for(const o in t){const i=await n.getResourceAsync(t[o]),a=i.get("https://atomicdata.dev/properties/shortname");let c=i.get("https://atomicdata.dev/properties/color");c||(c=s()),.5,r=(r=c).replace("#",""),c=`rgba(${parseInt(r.substring(0,2),16)}, ${parseInt(r.substring(2,4),16)}, ${parseInt(r.substring(4,6),16)}, 0.5)`;const u="#ffffff",l=(t,e,r)=>`\n            <button \n                style="background-color: ${e}; color: ${r}; border: 2px solid ${r}; font-weight: bold;" \n                onclick="conceptButtonFunction('${t}', '${e}')">\n                ${t}\n            </button>\n        `;e.push(l(a,c,u).trim())}var r;postMessage({type:"conceptButtons",buttons:e})}async function c(t,e,r="",o){const i=t.get("https://wiser-atomic.tunnelto.dev/collections/ontology/visuals/property/is-input-for"),s=await n.getResourceAsync(i),a=s.get("https://atomicdata.dev/properties/description"),c=s.get("https://wiser-atomic.tunnelto.dev/property/placeholder");var u;return o.push(i),e+("https://wiser-atomic.tunnelto.dev/property/th1piubjse"===i?`\n            <div style="display: grid; grid-template-columns: 1fr; grid-gap: 8px;">\n                <label for="${i}">${a}</label>\n                <input type="text" class="inputField" name="${i}" id="${i}" placeholder="${c}" value="${u=r,u.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}">\n            </div>\n        `:`\n        <div style="display: grid; grid-template-columns: 1fr; grid-gap: 8px;">\n            <label for="${i}" >${a}</label>\n            <textarea class="textareaField" name="${i}" id="${i}" placeholder="${c}"></textarea>\n        </div>\n    `)}async function u(t,e,r,o){const i=t.get("https://wiser-atomic.tunnelto.dev/collections/ontology/visuals/property/is-input-for"),s=t.get("https://wiser-atomic.tunnelto.dev/collections/ontology/visuals/property/option-class"),a=await n.getResourceAsync(s),c=a.get("https://atomicdata.dev/properties/shortname"),u=a.get("https://atomicdata.dev/properties/classes");o.push(i);let l=`\n        <div>\n            <label for="${i}">${c}</label>\n            <select class="dropdown" name="${i}" id="${i}">\n    `;for(const t of u)l+=`<option value="${t}">${(await n.getResourceAsync(t)).get("https://atomicdata.dev/properties/shortname")}</option>`;return l+="\n            </select>\n        </div>\n    ",e+l}async function l(t,e,r=""){const o=await n.getResourceAsync(t),i=o.get("https://atomicdata.dev/properties/description"),s=o.get("https://atomicdata.dev/properties/shortname"),a=o.get("https://wiser-atomic.tunnelto.dev/collections/ontology/concept/property/has-visuals");let l=[],p="<div>";p+=`\n                    <h2 class="title"> ${s} </h2>\n                    <div class="textInfo">${i}</div>\n                `;for(const t in a){const e=await n.getResourceAsync(a[t]);switch(e.getClasses()[0]){case"https://wiser-atomic.tunnelto.dev/collections/ontology/visuals/class/textarea":p=await c(e,p,r,l);break;case"https://wiser-atomic.tunnelto.dev/collections/ontology/visuals/class/dropdown":p=await u(e,p,0,l)}}p+="</div>",postMessage({type:"pong",magic:e,content:p,infoToLookFor:l})}async function p(){await n.setServerUrl("https://wiser-atomic.tunnelto.dev"),await n.preloadPropsAndClasses(),await n.setAgent(i),console.log("Atomic Worker: Store initialized successfully")}async function h(t){try{const e=(await n.getResourceAsync(t)).get("https://atomicdata.dev/properties/shortname");postMessage({type:"getResource",status:"success",shortName:e})}catch(t){console.error("Error fetching resource:",t),postMessage({type:"getResource",status:"error",error:t.message})}}onmessage=async t=>{const e=t.data;if(!e||!e.type)return console.error("Received message without type:",e),void postMessage({type:"error",error:"Message type is required"});switch(e.type){case"getConcepts":await a();break;case"getResource":if(!e.url)return void postMessage({type:"getResource",status:"error",error:"URL is required"});await h(e.url);break;case"ping":if(!e.magic||!e.url)return void postMessage({type:"ping",status:"error",error:"magic and url is required"});const t=await n.getResourceAsync(e.url);let r="no Concept found";t&&(r=await t.get("https://atomicdata.dev/properties/shortname")),postMessage({type:"pong",magic:e.magic,content:r});break;case"createModal":if(!e.url||!e.magic)return void postMessage({type:"createModal",status:"error",error:"I need to have a url and a magic word"});e.selectedText?await l(e.url,e.magic,e.selectedText):await l(e.url,e.magic);break;default:console.error("Unknown message type:",e.type),postMessage({type:"error",error:"Unknown message type"})}},await p(),e()}catch(d){e(d)}}),1)},516:(t,e,r)=>{"use strict";r.d(e,{g6:()=>h,Wl:()=>we,Kj:()=>P,z8:()=>ne,By:()=>fe,Tj:()=>_e,FW:()=>Me,il:()=>sr,lL:()=>pe,fp:()=>w,_f:()=>u,XP:()=>c,I8:()=>a,Cr:()=>Se,Fq:()=>ce,aw:()=>s,j6:()=>oe,VF:()=>ur,cy:()=>Re,Tk:()=>me,IY:()=>he,JB:()=>le,h_:()=>ue,qo:()=>cr,$6:()=>se,lq:()=>g,zT:()=>v,cU:()=>ae,dH:()=>Ne,DS:()=>lr,o2:()=>ar,pR:()=>Ee});var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},n=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},i=new Map;function s(t){return i.get(t)}var a={classes:{class:"https://atomicdata.dev/classes/Class",property:"https://atomicdata.dev/classes/Property",agent:"https://atomicdata.dev/classes/Agent",datatype:"https://atomicdata.dev/classes/Datatype",ontology:"https://atomicdata.dev/class/ontology"},properties:{allowsOnly:"https://atomicdata.dev/properties/allowsOnly",classtype:"https://atomicdata.dev/properties/classtype",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",write:"https://atomicdata.dev/properties/write",publicKey:"https://atomicdata.dev/properties/publicKey",instances:"https://atomicdata.dev/properties/instances",properties:"https://atomicdata.dev/properties/properties",classes:"https://atomicdata.dev/properties/classes",isLocked:"https://atomicdata.dev/properties/isLocked"}},c={classes:{commit:"https://atomicdata.dev/classes/Commit"},properties:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"}},u={classes:{collection:"https://atomicdata.dev/classes/Collection"},properties:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value",sortBy:"https://atomicdata.dev/properties/collection/sortBy",sortDesc:"https://atomicdata.dev/properties/collection/sortDesc",includeExternal:"https://atomicdata.dev/properties/collection/includeExternal"}},l=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},p=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},h=function(){function t(t,e){if(e&&P.tryValidSubject(e),!t)throw new we("Agent requires a private key");this.client=new P,this.subject=e,this.privateKey=t}return t.fromSecret=function(e){var r=atob(e),o=JSON.parse(r);return new t(o.privateKey,o.subject)},t.prototype.getPublicKey=function(){return l(this,void 0,void 0,(function(){var t;return p(this,(function(e){switch(e.label){case 0:return this.publicKey?[3,2]:[4,ce(this.privateKey)];case 1:t=e.sent(),this.publicKey=t,e.label=2;case 2:return[2,this.publicKey]}}))}))},t.prototype.buildSecret=function(){var t=JSON.stringify(this);return btoa(t)},t.prototype.verifyPublicKeyWithServer=function(){var t;return l(this,void 0,void 0,(function(){var e,r,o;return p(this,(function(n){switch(n.label){case 0:if(!this.subject)throw new we("Agent has no subject");return[4,this.client.fetchResourceHTTP(this.subject)];case 1:if((e=n.sent().resource).error)throw new Error("Could not fetch agent, and could therefore not check validity of public key. ".concat(e.error));return r=null===(t=e.get(cr.agent.publicKey))||void 0===t?void 0:t.toString(),o=r,[4,this.getPublicKey()];case 2:if(o!==n.sent())throw new Error("Fetched publickey does not match current one - is the private key correct?");return[2]}}))}))},t}(),d=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},f=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function y(t,e){return d(this,void 0,void 0,(function(){var r,o,n,i;return f(this,(function(s){switch(s.label){case 0:if(r=oe(),!e.subject)throw new Error("Agent has no subject, cannot authenticate");return i={"https://atomicdata.dev/properties/auth/agent":e.subject,"https://atomicdata.dev/properties/auth/requestedSubject":t},o="https://atomicdata.dev/properties/auth/publicKey",[4,e.getPublicKey()];case 1:return i[o]=s.sent(),i["https://atomicdata.dev/properties/auth/timestamp"]=r,n="https://atomicdata.dev/properties/auth/signature",[4,m(t,e,r)];case 2:return i[n]=s.sent(),[2,i]}}))}))}function m(t,e,r){return d(this,void 0,void 0,(function(){var o;return f(this,(function(n){switch(n.label){case 0:return o="".concat(t," ").concat(r),[4,ae(o,e.privateKey)];case 1:return[2,n.sent()]}}))}))}function v(t,e,r){return d(this,void 0,void 0,(function(){var o,n,i,s,a;return f(this,(function(c){switch(c.label){case 0:return o=oe(),!(null==e?void 0:e.subject)||function(t,e){var r;return!t.startsWith("http://localhost")&&(null===(r=null==e?void 0:e.subject)||void 0===r?void 0:r.startsWith("http://localhost"))}(t,e)?[3,3]:(n=r,i="x-atomic-public-key",[4,e.getPublicKey()]);case 1:return n[i]=c.sent(),s=r,a="x-atomic-signature",[4,m(t,e,o)];case 2:s[a]=c.sent(),r["x-atomic-timestamp"]=o,r["x-atomic-agent"]=null==e?void 0:e.subject,c.label=3;case 3:return[2,r]}}))}))}var b="atomic_session",g=function(t,e){y(t,e).then((function(e){!function(t,e,r,o){void 0===o&&(o=864e5);var n=new Date(Date.now()+o).toUTCString(),i=encodeURIComponent(e),s=new URL(r).hostname,a="".concat(t,"=").concat(i,";Expires=").concat(n,";Domain=").concat(s,";SameSite=Lax;path=/");document.cookie=a}(b,btoa(JSON.stringify(e)),t)}))},w=function(){var t=document.cookie.match(/^(.*;)?\s*atomic_session\s*=\s*[^;]+(.*)?$/);return!!t&&t.length>0};function S(){return globalThis===globalThis.window}var x=r(945),A=function(){return A=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},A.apply(this,arguments)},E=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},R=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},j=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},P=function(){function t(t){this.__fetchOverride=t}return Object.defineProperty(t.prototype,"fetch",{get:function(){var t,e=null!==(t=this.__fetchOverride)&&void 0!==t?t:x;if(void 0===e)throw new we("No fetch available, If the current environment doesn't have a fetch implementation you can pass one yourself.");return e},enumerable:!1,configurable:!0}),t.tryValidSubject=function(t){try{new URL(t)}catch(e){throw new Error("Not a valid URL: ".concat(t,". ").concat(e))}},t.isValidSubject=function(e){if("string"!=typeof e)return!1;try{return t.tryValidSubject(e),!0}catch(t){return!1}},t.removeQueryParamsFromURL=function(t){return null==t?void 0:t.split("?")[0]},t.prototype.setFetch=function(t){this.__fetchOverride=t},t.prototype.fetchResourceHTTP=function(e,r){return void 0===r&&(r={}),E(this,void 0,void 0,(function(){var o,n,i,s,a,c,u,l,p,h,d,f,y,m,b,x,A;return R(this,(function(E){switch(E.label){case 0:o=r.signInfo,n=r.from,i=r.body,s=r.method,a=[],c=new _e,u=new Me(e),E.label=1;case 1:return E.trys.push([1,7,,8]),t.tryValidSubject(e),(l={}).Accept="application/ad+json",o?S()&&e.startsWith(window.location.origin)?(w()||g(o.serverURL,o.agent),[3,4]):[3,2]:[3,4];case 2:return[4,v(e,o.agent,l)];case 3:E.sent(),E.label=4;case 4:return p=e,void 0!==n&&((h=new URL("".concat(n,"/path"))).searchParams.set("path",e),p=h.href),[4,this.fetch(p,{headers:l,method:null!=s?s:"GET",body:i})];case 5:return[4,(d=E.sent()).text()];case 6:if(f=E.sent(),200!==d.status)throw 401===d.status?new we(f,fe.Unauthorized):500===d.status?new we(f,fe.Server):404===d.status?new we(f,fe.NotFound):new we(f);try{y=JSON.parse(f),r.noNested?u=y:(m=j(c.parseObject(y,e),2),b=m[0],x=m[1],u=b,a.push.apply(a,function(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}([],j(x),!1)))}catch(t){throw new we("Could not parse JSON from fetching ".concat(e,". Is it an Atomic Data resource? Error message: ").concat(t.message))}return[3,8];case 7:return A=E.sent(),u.setError(A),a=[u],console.error(e,A),[3,8];case 8:return u.loading=!1,[2,{resource:u,createdResources:a}]}}))}))},t.prototype.postCommit=function(t,e){return E(this,void 0,void 0,(function(){var r,o,n,i,s;return R(this,(function(a){switch(a.label){case 0:r=se(A({},t)),(o=new Headers).set("Content-Type","application/ad+json"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.fetch(e,{headers:o,method:"POST",body:r})];case 2:return n=a.sent(),[3,4];case 3:throw i=a.sent(),new we("Posting Commit to ".concat(e," failed: ").concat(i));case 4:return[4,n.text()];case 5:if(s=a.sent(),200!==n.status)throw new we(s,fe.Server);return[2,le(s)]}}))}))},t.prototype.uploadFiles=function(t,e,r,o){return E(this,void 0,void 0,(function(){var n,i,s,a,c,u,l,p;return R(this,(function(h){switch(h.label){case 0:return n=new _e,i=new FormData,t.map((function(t){!function(t){return"blob"in t&&"name"in t}(t)?i.append("assets",t,t.name):i.append("assets",t.blob,t.name)})),(s=new URL("".concat(e,"/upload"))).searchParams.set("parent",o),[4,v(s.toString(),r,{})];case 1:return a=h.sent(),c={method:"POST",body:i,headers:a},[4,this.fetch(s.toString(),c)];case 2:return[4,(u=h.sent()).text()];case 3:if(l=h.sent(),200!==u.status)throw Error(l);return p=JSON.parse(l),[2,j(n.parseArray(p),1)[0]]}}))}))},t}(),O=r(122);const U=BigInt(0),k=BigInt(1),C=BigInt(2),_=BigInt(255),B=C**BigInt(252)+BigInt("27742317777372353535851937790883648493"),T={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:C**_-BigInt(19),l:B,n:B,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},F=C**BigInt(256),I=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),N=(BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235")),M=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),D=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),L=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class z{constructor(t,e,r,o){this.x=t,this.y=e,this.z=r,this.t=o}static fromAffine(t){if(!(t instanceof J))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(J.ZERO)?z.ZERO:new z(t.x,t.y,k,ot(t.x*t.y))}static toAffineBatch(t){const e=function(t,e=T.P){const r=new Array(t.length),o=t.reduce(((t,o,n)=>o===U?t:(r[n]=t,ot(t*o,e))),k),n=nt(o,e);return t.reduceRight(((t,o,n)=>o===U?t:(r[n]=ot(t*r[n],e),ot(t*o,e))),n),r}(t.map((t=>t.z)));return t.map(((t,r)=>t.toAffine(e[r])))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){W(t);const{x:e,y:r,z:o}=this,{x:n,y:i,z:s}=t,a=ot(e*s),c=ot(n*o),u=ot(r*s),l=ot(i*o);return a===c&&u===l}negate(){return new z(ot(-this.x),this.y,this.z,ot(-this.t))}double(){const{x:t,y:e,z:r}=this,{a:o}=T,n=ot(t**C),i=ot(e**C),s=ot(C*ot(r**C)),a=ot(o*n),c=ot(ot((t+e)**C)-n-i),u=a+i,l=u-s,p=a-i,h=ot(c*l),d=ot(u*p),f=ot(c*p),y=ot(l*u);return new z(h,d,y,f)}add(t){W(t);const{x:e,y:r,z:o,t:n}=this,{x:i,y:s,z:a,t:c}=t,u=ot((r-e)*(s+i)),l=ot((r+e)*(s-i)),p=ot(l-u);if(p===U)return this.double();const h=ot(o*C*c),d=ot(n*C*a),f=d+h,y=l+u,m=d-h,v=ot(f*p),b=ot(y*m),g=ot(f*m),w=ot(p*y);return new z(v,b,w,g)}subtract(t){return this.add(t.negate())}precomputeWindow(t){const e=1+256/t,r=[];let o=this,n=o;for(let i=0;i<e;i++){n=o,r.push(n);for(let e=1;e<2**(t-1);e++)n=n.add(o),r.push(n);o=n.double()}return r}wNAF(t,e){!e&&this.equals(z.BASE)&&(e=J.BASE);const r=e&&e._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let o=e&&V.get(e);o||(o=this.precomputeWindow(r),e&&1!==r&&(o=z.normalizeZ(o),V.set(e,o)));let n=z.ZERO,i=z.ZERO;const s=1+256/r,a=2**(r-1),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let e=0;e<s;e++){const r=e*a;let s=Number(t&c);if(t>>=l,s>a&&(s-=u,t+=k),0===s){let t=o[r];e%2&&(t=t.negate()),i=i.add(t)}else{let t=o[r+Math.abs(s)-1];s<0&&(t=t.negate()),n=n.add(t)}}return z.normalizeZ([n,i])[0]}multiply(t,e){return this.wNAF(lt(t,T.l),e)}multiplyUnsafe(t){let e=lt(t,T.l,!1);const r=z.BASE,o=z.ZERO;if(e===U)return o;if(this.equals(o)||e===k)return this;if(this.equals(r))return this.wNAF(e);let n=o,i=this;for(;e>U;)e&k&&(n=n.add(i)),i=i.double(),e>>=k;return n}isSmallOrder(){return this.multiplyUnsafe(T.h).equals(z.ZERO)}isTorsionFree(){return this.multiplyUnsafe(T.l).equals(z.ZERO)}toAffine(t=nt(this.z)){const{x:e,y:r,z:o}=this,n=ot(e*t),i=ot(r*t);if(ot(o*t)!==k)throw new Error("invZ was invalid");return new J(n,i)}fromRistrettoBytes(){q()}toRistrettoBytes(){q()}fromRistrettoHash(){q()}}function W(t){if(!(t instanceof z))throw new TypeError("ExtendedPoint expected")}function G(t){if(!(t instanceof H))throw new TypeError("RistrettoPoint expected")}function q(){throw new Error("Legacy method: switch to RistrettoPoint")}z.BASE=new z(T.Gx,T.Gy,k,ot(T.Gx*T.Gy)),z.ZERO=new z(U,k,k,U);class H{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){const{d:e}=T,r=ot(I*t*t),o=ot((r+k)*D);let n=BigInt(-1);const i=ot((n-e*r)*ot(r+e));let{isValid:s,value:a}=st(o,i),c=ot(a*t);tt(c)||(c=ot(-c)),s||(a=c),s||(n=r);const u=ot(n*(r-k)*L-i),l=a*a,p=ot((a+a)*i),h=ot(u*N),d=ot(k-l),f=ot(k+l);return new z(ot(p*f),ot(d*h),ot(h*f),ot(p*d))}static hashToCurve(t){const e=rt((t=ut(t,64)).slice(0,32)),r=this.calcElligatorRistrettoMap(e),o=rt(t.slice(32,64)),n=this.calcElligatorRistrettoMap(o);return new H(r.add(n))}static fromHex(t){t=ut(t,32);const{a:e,d:r}=T,o="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",n=rt(t);if(!function(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}(X(n),t)||tt(n))throw new Error(o);const i=ot(n*n),s=ot(k+e*i),a=ot(k-e*i),c=ot(s*s),u=ot(a*a),l=ot(e*r*c-u),{isValid:p,value:h}=at(ot(l*u)),d=ot(h*a),f=ot(h*d*l);let y=ot((n+n)*d);tt(y)&&(y=ot(-y));const m=ot(s*f),v=ot(y*m);if(!p||tt(v)||m===U)throw new Error(o);return new H(new z(y,m,k,v))}toRawBytes(){let{x:t,y:e,z:r,t:o}=this.ep;const n=ot(ot(r+e)*ot(r-e)),i=ot(t*e),{value:s}=at(ot(n*i**C)),a=ot(s*n),c=ot(s*i),u=ot(a*c*o);let l;if(tt(o*u)){let r=ot(e*I),o=ot(t*I);t=r,e=o,l=ot(a*M)}else l=c;tt(t*u)&&(e=ot(-e));let p=ot((r-e)*l);return tt(p)&&(p=ot(-p)),X(p)}toHex(){return Z(this.toRawBytes())}toString(){return this.toHex()}equals(t){G(t);const e=this.ep,r=t.ep,o=ot(e.x*r.y)===ot(e.y*r.x),n=ot(e.y*r.y)===ot(e.x*r.x);return o||n}add(t){return G(t),new H(this.ep.add(t.ep))}subtract(t){return G(t),new H(this.ep.subtract(t.ep))}multiply(t){return new H(this.ep.multiply(t))}multiplyUnsafe(t){return new H(this.ep.multiplyUnsafe(t))}}H.BASE=new H(z.BASE),H.ZERO=new H(z.ZERO);const V=new WeakMap;class J{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,V.delete(this)}static fromHex(t,e=!0){const{d:r,P:o}=T,n=(t=ut(t,32)).slice();n[31]=-129&t[31];const i=et(n);if(e&&i>=o)throw new Error("Expected 0 < hex < P");if(!e&&i>=F)throw new Error("Expected 0 < hex < 2**256");const s=ot(i*i),a=ot(s-k),c=ot(r*s+k);let{isValid:u,value:l}=st(a,c);if(!u)throw new Error("Point.fromHex: invalid y coordinate");const p=(l&k)===k;return 0!=(128&t[31])!==p&&(l=ot(-l)),new J(l,i)}static async fromPrivateKey(t){return(await pt(t)).point}toRawBytes(){const t=X(this.y);return t[31]|=this.x&k?128:0,t}toHex(){return Z(this.toRawBytes())}toX25519(){const{y:t}=this;return X(ot((k+t)*nt(k-t)))}isTorsionFree(){return z.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new J(ot(-this.x),this.y)}add(t){return z.fromAffine(this).add(z.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return z.fromAffine(this).multiply(t,this).toAffine()}}J.BASE=new J(T.Gx,T.Gy),J.ZERO=new J(U,k);class K{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){const e=ut(t,64),r=J.fromHex(e.slice(0,32),!1),o=et(e.slice(32,64));return new K(r,o)}assertValidity(){const{r:t,s:e}=this;if(!(t instanceof J))throw new Error("Expected Point instance");return lt(e,T.l,!1),this}toRawBytes(){const t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(X(this.s),32),t}toHex(){return Z(this.toRawBytes())}}const $=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Z(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=$[t[r]];return e}function Y(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){const o=2*r,n=t.slice(o,o+2),i=Number.parseInt(n,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[r]=i}return e}function Q(t){return Y(t.toString(16).padStart(64,"0"))}function X(t){return Q(t).reverse()}function tt(t){return(ot(t)&k)===k}function et(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Z(Uint8Array.from(t).reverse()))}function rt(t){return ot(et(t)&C**_-k)}function ot(t,e=T.P){const r=t%e;return r>=U?r:e+r}function nt(t,e=T.P){if(t===U||e<=U)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=ot(t,e),o=e,n=U,i=k,s=k,a=U;for(;r!==U;){const t=o/r,e=o%r,c=n-s*t,u=i-a*t;o=r,r=e,n=s,i=a,s=c,a=u}if(o!==k)throw new Error("invert: does not exist");return ot(n,e)}function it(t,e){const{P:r}=T;let o=t;for(;e-- >U;)o*=o,o%=r;return o}function st(t,e){const r=ot(e*e*e),o=ot(r*r*e);let n=ot(t*r*function(t){const{P:e}=T,r=BigInt(5),o=BigInt(10),n=BigInt(20),i=BigInt(40),s=BigInt(80),a=t*t%e*t%e,c=it(a,C)*a%e,u=it(c,k)*t%e,l=it(u,r)*u%e,p=it(l,o)*l%e,h=it(p,n)*p%e,d=it(h,i)*h%e,f=it(d,s)*d%e,y=it(f,s)*d%e,m=it(y,o)*l%e;return{pow_p_5_8:it(m,C)*t%e,b2:a}}(t*o).pow_p_5_8);const i=ot(e*n*n),s=n,a=ot(n*I),c=i===t,u=i===ot(-t),l=i===ot(-t*I);return c&&(n=s),(u||l)&&(n=a),tt(n)&&(n=ot(-n)),{isValid:c||u,value:n}}function at(t){return st(k,t)}async function ct(...t){const e=await yt.sha512(function(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Expected Uint8Array list");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),r=new Uint8Array(e);for(let e=0,o=0;e<t.length;e++){const n=t[e];r.set(n,o),o+=n.length}return r}(...t));return ot(et(e),T.l)}function ut(t,e){const r=t instanceof Uint8Array?Uint8Array.from(t):Y(t);if("number"==typeof e&&r.length!==e)throw new Error(`Expected ${e} bytes`);return r}function lt(t,e,r=!0){if(!e)throw new TypeError("Specify max value");if("number"==typeof t&&Number.isSafeInteger(t)&&(t=BigInt(t)),"bigint"==typeof t&&t<e)if(r){if(U<t)return t}else if(U<=t)return t;throw new TypeError("Expected valid scalar: 0 < scalar < max")}async function pt(t){if(32!==(t="bigint"==typeof t||"number"==typeof t?Q(lt(t,F)):ut(t)).length)throw new Error("Expected 32 bytes");const e=await yt.sha512(t),r=((a=e.slice(0,32))[0]&=248,a[31]&=127,a[31]|=64,a),o=e.slice(32,64),n=ot(et(r),T.l),i=J.BASE.multiply(n),s=i.toRawBytes();var a;return{head:r,prefix:o,scalar:n,point:i,pointBytes:s}}async function ht(t){return(await pt(t)).pointBytes}async function dt(t,e){t=ut(t);const{prefix:r,scalar:o,pointBytes:n}=await pt(e),i=await ct(r,t),s=J.BASE.multiply(i),a=ot(i+await ct(s.toRawBytes(),n,t)*o,T.l);return new K(s,a).toRawBytes()}J.BASE._setWindowSize(8);const ft={node:O,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},yt={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Z,getExtendedPublicKey:pt,mod:ot,invert:nt,hashToPrivateScalar:t=>{if((t=ut(t)).length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=ot(et(t),T.l);if(e===U||e===k)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>{if(ft.web)return ft.web.getRandomValues(new Uint8Array(t));if(ft.node){const{randomBytes:e}=ft.node;return new Uint8Array(e(t).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>yt.randomBytes(32),sha512:async t=>{if(ft.web){const e=await ft.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}if(ft.node)return Uint8Array.from(ft.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")},precompute(t=8,e=J.BASE){const r=e.equals(J.BASE)?e:new J(e.x,e.y);return r._setWindowSize(t),r.multiply(C),r}};for(var mt=r(492),vt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bt="undefined"==typeof Uint8Array?[]:new Uint8Array(256),gt=0;gt<64;gt++)bt[vt.charCodeAt(gt)]=gt;var wt=function(t){var e,r=new Uint8Array(t),o=r.length,n="";for(e=0;e<o;e+=3)n+=vt[r[e]>>2],n+=vt[(3&r[e])<<4|r[e+1]>>4],n+=vt[(15&r[e+1])<<2|r[e+2]>>6],n+=vt[63&r[e+2]];return o%3==2?n=n.substring(0,n.length-1)+"=":o%3==1&&(n=n.substring(0,n.length-2)+"=="),n},St=function(t){var e,r,o,n,i,s=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var u=new ArrayBuffer(s),l=new Uint8Array(u);for(e=0;e<a;e+=4)r=bt[t.charCodeAt(e)],o=bt[t.charCodeAt(e+1)],n=bt[t.charCodeAt(e+2)],i=bt[t.charCodeAt(e+3)],l[c++]=r<<2|o>>4,l[c++]=(15&o)<<4|n>>2,l[c++]=(3&n)<<6|63&i;return u};"object"==typeof self&&"crypto"in self&&self.crypto;const xt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function At(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new TypeError("utf8ToBytes expected string, got "+typeof t);return(new TextEncoder).encode(t)}(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0"))),(()=>{const t="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);try{if(t){const{setImmediate:e}=t("timers");return()=>new Promise((t=>e(t)))}}catch(t){}})();class Et{clone(){return this._cloneInto()}}function Rt(t){const e=e=>t().update(At(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.init=e.create=()=>t(),e}class jt extends Et{constructor(t,e,r,o){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=xt(this.buffer)}update(t){if(this.destroyed)throw new Error("instance is destroyed");const{view:e,buffer:r,blockLen:o,finished:n}=this;if(n)throw new Error("digest() was already called");const i=(t=At(t)).length;for(let n=0;n<i;){const s=Math.min(o-this.pos,i-n);if(s!==o)r.set(t.subarray(n,n+s),this.pos),this.pos+=s,n+=s,this.pos===o&&(this.process(e,0),this.pos=0);else{const e=xt(t);for(;o<=i-n;n+=o)this.process(e,n)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){if(this.destroyed)throw new Error("instance is destroyed");if(!(t instanceof Uint8Array)||t.length<this.outputLen)throw new Error("_Sha2: Invalid output buffer");if(this.finished)throw new Error("digest() was already called");this.finished=!0;const{buffer:e,view:r,blockLen:o,isLE:n}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let t=i;t<o;t++)e[t]=0;!function(t,e,r,o){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,o);const n=BigInt(32),i=BigInt(4294967295),s=Number(r>>n&i),a=Number(r&i),c=o?4:0,u=o?0:4;t.setUint32(e+c,s,o),t.setUint32(e+u,a,o)}(r,o-8,BigInt(8*this.length),n),this.process(r,0);const s=xt(t);this.get().forEach(((t,e)=>s.setUint32(4*e,t,n)))}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:o,finished:n,destroyed:i,pos:s}=this;return t.length=o,t.pos=s,t.finished=n,t.destroyed=i,o%e&&t.buffer.set(r),t}}const Pt=BigInt(2**32-1),Ot=BigInt(32);function Ut(t,e=!1){return e?{h:Number(t&Pt),l:Number(t>>Ot&Pt)}:{h:0|Number(t>>Ot&Pt),l:0|Number(t&Pt)}}const kt=(t,e,r)=>t>>>r,Ct=(t,e,r)=>t<<32-r|e>>>r,_t=(t,e,r)=>t>>>r|e<<32-r,Bt=(t,e,r)=>t<<32-r|e>>>r,Tt=(t,e,r)=>t<<64-r|e>>>r-32,Ft=(t,e,r)=>t>>>r-32|e<<64-r;function It(t,e,r,o){const n=(e>>>0)+(o>>>0);return{h:t+r+(n/2**32|0)|0,l:0|n}}const Nt=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Mt=(t,e,r,o)=>e+r+o+(t/2**32|0)|0,Dt=(t,e,r,o)=>(t>>>0)+(e>>>0)+(r>>>0)+(o>>>0),Lt=(t,e,r,o,n)=>e+r+o+n+(t/2**32|0)|0,zt=(t,e,r,o,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(o>>>0)+(n>>>0),Wt=(t,e,r,o,n,i)=>e+r+o+n+i+(t/2**32|0)|0,[Gt,qt]=function(t,e=!1){let r=new Uint32Array(t.length),o=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:i,l:s}=Ut(t[n],e);[r[n],o[n]]=[i,s]}return[r,o]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((t=>BigInt(t)))),Ht=new Uint32Array(80),Vt=new Uint32Array(80);class Jt extends jt{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:r,Bl:o,Ch:n,Cl:i,Dh:s,Dl:a,Eh:c,El:u,Fh:l,Fl:p,Gh:h,Gl:d,Hh:f,Hl:y}=this;return[t,e,r,o,n,i,s,a,c,u,l,p,h,d,f,y]}set(t,e,r,o,n,i,s,a,c,u,l,p,h,d,f,y){this.Ah=0|t,this.Al=0|e,this.Bh=0|r,this.Bl=0|o,this.Ch=0|n,this.Cl=0|i,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|u,this.Fh=0|l,this.Fl=0|p,this.Gh=0|h,this.Gl=0|d,this.Hh=0|f,this.Hl=0|y}process(t,e){for(let r=0;r<16;r++,e+=4)Ht[r]=t.getUint32(e),Vt[r]=t.getUint32(e+=4);for(let t=16;t<80;t++){const e=0|Ht[t-15],r=0|Vt[t-15],o=_t(e,r,1)^_t(e,r,8)^kt(e,0,7),n=Bt(e,r,1)^Bt(e,r,8)^Ct(e,r,7),i=0|Ht[t-2],s=0|Vt[t-2],a=_t(i,s,19)^Tt(i,s,61)^kt(i,0,6),c=Bt(i,s,19)^Ft(i,s,61)^Ct(i,s,6),u=Dt(n,c,Vt[t-7],Vt[t-16]),l=Lt(u,o,a,Ht[t-7],Ht[t-16]);Ht[t]=0|l,Vt[t]=0|u}let{Ah:r,Al:o,Bh:n,Bl:i,Ch:s,Cl:a,Dh:c,Dl:u,Eh:l,El:p,Fh:h,Fl:d,Gh:f,Gl:y,Hh:m,Hl:v}=this;for(let t=0;t<80;t++){const e=_t(l,p,14)^_t(l,p,18)^Tt(l,p,41),b=Bt(l,p,14)^Bt(l,p,18)^Ft(l,p,41),g=l&h^~l&f,w=zt(v,b,p&d^~p&y,qt[t],Vt[t]),S=Wt(w,m,e,g,Gt[t],Ht[t]),x=0|w,A=_t(r,o,28)^Tt(r,o,34)^Tt(r,o,39),E=Bt(r,o,28)^Ft(r,o,34)^Ft(r,o,39),R=r&n^r&s^n&s,j=o&i^o&a^i&a;m=0|f,v=0|y,f=0|h,y=0|d,h=0|l,d=0|p,({h:l,l:p}=It(0|c,0|u,0|S,0|x)),c=0|s,u=0|a,s=0|n,a=0|i,n=0|r,i=0|o;const P=Nt(x,E,j);r=Mt(P,S,A,R),o=0|P}({h:r,l:o}=It(0|this.Ah,0|this.Al,0|r,0|o)),({h:n,l:i}=It(0|this.Bh,0|this.Bl,0|n,0|i)),({h:s,l:a}=It(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:u}=It(0|this.Dh,0|this.Dl,0|c,0|u)),({h:l,l:p}=It(0|this.Eh,0|this.El,0|l,0|p)),({h,l:d}=It(0|this.Fh,0|this.Fl,0|h,0|d)),({h:f,l:y}=It(0|this.Gh,0|this.Gl,0|f,0|y)),({h:m,l:v}=It(0|this.Hh,0|this.Hl,0|m,0|v)),this.set(r,o,n,i,s,a,c,u,l,p,h,d,f,y,m,v)}roundClean(){Ht.fill(0),Vt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Kt extends Jt{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class $t extends Jt{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}const Zt=Rt((()=>new Jt));Rt((()=>new Kt)),Rt((()=>new $t));var Yt=function(){return Yt=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},Yt.apply(this,arguments)},Qt=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},Xt=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},te=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ee=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},re=function(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};function oe(){return Math.round((new Date).getTime())}yt.sha512=function(t){return Promise.resolve(Zt(t))};var ne=function(){function t(t,e){var r,o,n;void 0===e&&(e={}),this._subject=P.removeQueryParamsFromURL(t),this._set=null!==(r=e.set)&&void 0!==r?r:new Map,this._push=null!==(o=e.push)&&void 0!==o?o:new Map,this._remove=null!==(n=e.remove)&&void 0!==n?n:new Set,this._destroy=e.destroy,this._previousCommit=e.previousCommit}return Object.defineProperty(t.prototype,"subject",{get:function(){return this._subject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"set",{get:function(){return this._set},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"push",{get:function(){return this._push},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remove",{get:function(){return this._remove},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroy",{get:function(){return this._destroy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousCommit",{get:function(){return this._previousCommit},enumerable:!1,configurable:!0}),t.prototype.addSetAction=function(t,e){return this.removeRemoveAction(t),this._set.set(t,e),this},t.prototype.addPushAction=function(t){for(var e,r,o,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=null!==(o=this._push.get(t))&&void 0!==o?o:new Set;try{for(var a=te(n),c=a.next();!c.done;c=a.next()){var u=c.value;s.add(u)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return this._push.set(t,s),this},t.prototype.addRemoveAction=function(t){return this._set.delete(t),this._push.delete(t),this._remove.add(t),this},t.prototype.removeRemoveAction=function(t){return this._remove.delete(t),this},t.prototype.setDestroy=function(t){return this._destroy=t,this},t.prototype.setPreviousCommit=function(t){return this._previousCommit=t,this},t.prototype.setSubject=function(t){return this._subject=t,this},t.prototype.sign=function(t,e){return Qt(this,void 0,void 0,(function(){return Xt(this,(function(r){switch(r.label){case 0:return[4,this.signAt(e,t,oe())];case 1:return[2,r.sent()]}}))}))},t.prototype.hasUnsavedChanges=function(){return this.set.size>0||this.push.size>0||this.destroy||this.remove.size>0},t.prototype.clone=function(){var e={set:this.set,push:this.push,remove:this.remove,destroy:this.destroy,previousCommit:this.previousCommit};return new t(this.subject,structuredClone(e))},t.prototype.toPlainObject=function(){return{subject:this.subject,set:Object.fromEntries(this.set.entries()),push:Object.fromEntries(Array.from(this.push.entries()).map((function(t){var e=ee(t,2),r=e[0],o=e[1];return[r,Array.from(o)]}))),remove:Array.from(this.remove),destroy:this.destroy,previousCommit:this.previousCommit}},t.prototype.signAt=function(t,e,r){return Qt(this,void 0,void 0,(function(){var o,n,i;return Xt(this,(function(s){switch(s.label){case 0:if(void 0===t)throw new Error("No agent passed to sign commit");if(!this.hasUnsavedChanges())throw new Error("No changes to commit in ".concat(this.subject));return o=Yt(Yt({},this.clone().toPlainObject()),{createdAt:r,signer:t}),n=se(Yt({},o)),[4,ae(n,e)];case 1:return i=s.sent(),[2,Yt(Yt({},o),{signature:i})]}}))}))},t}();function ie(t,e,r){e in t&&e!==r&&(Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(t,e)),delete t[e])}function se(t){return t.remove&&0===Object.keys(t.remove).length&&delete t.remove,t.set&&0===Object.keys(t.set).length&&delete t.set,t.push&&0===Object.keys(t.push).length&&delete t.push,!1===t.destroy&&delete t.destroy,ie(t,"createdAt",lr.properties.commit.createdAt),ie(t,"subject",lr.properties.commit.subject),ie(t,"set",lr.properties.commit.set),ie(t,"push",lr.properties.commit.push),ie(t,"signer",lr.properties.commit.signer),ie(t,"signature",lr.properties.commit.signature),ie(t,"remove",lr.properties.commit.remove),ie(t,"destroy",lr.properties.commit.destroy),ie(t,"previousCommit",lr.properties.commit.previousCommit),t[lr.properties.isA]=[lr.classes.commit],mt(t)}var ae=function(t,e){return Qt(void 0,void 0,void 0,(function(){var r,o,n;return Xt(this,(function(i){switch(i.label){case 0:return r=St(e),o=new Uint8Array(r),[4,dt((new TextEncoder).encode(t),o)];case 1:return n=i.sent(),[2,wt(n)]}}))}))},ce=function(t){return Qt(void 0,void 0,void 0,(function(){var e,r;return Xt(this,(function(o){switch(o.label){case 0:return e=St(t),[4,ht(new Uint8Array(e))];case 1:return r=o.sent(),[2,wt(r)]}}))}))};function ue(t){return{id:t.getSubject(),subject:t.get(lr.properties.commit.subject),set:t.get(lr.properties.commit.set),push:t.get(lr.properties.commit.push),signer:t.get(lr.properties.commit.signer),createdAt:t.get(lr.properties.commit.createdAt),remove:t.get(lr.properties.commit.remove),destroy:t.get(lr.properties.commit.destroy),signature:t.get(lr.properties.commit.signature)}}function le(t){try{var e=JSON.parse(t);if("object"!=typeof e)throw new Error("Commit is not an object");var r=e[lr.properties.commit.subject],o=e[lr.properties.commit.set],n=e[lr.properties.commit.push],i=e[lr.properties.commit.signer],s=e[lr.properties.commit.createdAt],a=e[lr.properties.commit.remove],c=e[lr.properties.commit.destroy],u=e[lr.properties.commit.signature],l=e["@id"],p=e[lr.properties.commit.previousCommit];if(!u)throw new Error("Commit has no signature");return{subject:r,set:o,push:n,signer:i,createdAt:s,remove:a,destroy:c,signature:u,id:l,previousCommit:p}}catch(e){throw new Error("Could not parse commit: ".concat(e,", Commit: ").concat(t))}}function pe(t,e){var r=e.set,o=e.remove,n=e.push;return r&&function(t,e,r){var o,n,i=new _e,s=[],a=function(t,r){var o=r;if((null==r?void 0:r.constructor)==={}.constructor){var n=ee(i.parseValue(r,t),2),a=n[0],c=n[1];o=a,s.push.apply(s,re([],ee(c),!1))}Re(r)&&(o=r.map((function(e){var r=ee(i.parseValue(e,t),2),o=r[0],n=r[1];return s.push.apply(s,re([],ee(n),!1)),o}))),e.setUnsafe(t,o)};try{for(var c=te(Object.entries(t)),u=c.next();!u.done;u=c.next()){var l=ee(u.value,2);a(l[0],l[1])}}catch(t){o={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(o)throw o.error}}}(r,t),o&&function(t,e){var r,o;try{for(var n=te(t),i=n.next();!i.done;i=n.next()){var s=i.value;e.removePropValLocally(s)}}catch(t){r={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}}(o,t),n&&function(t,e,r){var o,n,i=new _e,s=[],a=function(t,r){var o=e.get(t)||[],n=r.map((function(e){var r=ee(i.parseValue(e,t),2),o=r[0],n=r[1];return s.push.apply(s,re([],ee(n),!1)),o})),a=re(re([],ee(o),!1),ee(n),!1);e.setUnsafe(t,a)};try{for(var c=te(Object.entries(t)),u=c.next();!u.done;u=c.next()){var l=ee(u.value,2);a(l[0],l[1])}}catch(t){o={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(o)throw o.error}}}(n,t),t}function he(t,e){var r=le(t),o=r.subject,n=r.id,i=r.destroy,s=r.signature,a=e.resources.get(o);if(a){if(a.appliedCommitSignatures.has(s))return}else a=new Me(o);a=pe(a,r),n&&a.setUnsafe(cr.commit.lastCommit,n),i?e.removeResource(o):(a.appliedCommitSignatures.add(s),e.addResources(a,{skipCommitCompare:!0}))}var de,fe,ye=(de=function(t,e){return de=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},de(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}de(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function me(t){if(t instanceof we){if(t.type===fe.Unauthorized)return!0;if(t.message.includes("Unauthorized"))return!0}return!1}!function(t){t.Unauthorized="Unauthorized",t.NotFound="NotFound",t.Server="Server",t.Client="Client"}(fe||(fe={}));var ve,be,ge,we=function(t){function e(r,o){void 0===o&&(o=fe.Client);var n=t.call(this,r)||this;Object.setPrototypeOf(n,e.prototype),n.type=o,n.message=r;try{var i=JSON.parse(r)[cr.description];i&&(n.message=i)}catch(t){}return n.message||(n.message=n.createMessage()),n}return ye(e,t),e.fromResource=function(t){return new e(t.get(cr.description).toString())},e.prototype.createMessage=function(){switch(this.type){case fe.Unauthorized:return"You don't have the rights to do this.";case fe.NotFound:return"404 Not found.";case fe.Server:return"500 Unknown server error.";default:return"Unknown error."}},e}(Error);(ge=be||(be={})).ATOMIC_URL="https://atomicdata.dev/datatypes/atomicURL",ge.BOOLEAN="https://atomicdata.dev/datatypes/boolean",ge.DATE="https://atomicdata.dev/datatypes/date",ge.FLOAT="https://atomicdata.dev/datatypes/float",ge.INTEGER="https://atomicdata.dev/datatypes/integer",ge.MARKDOWN="https://atomicdata.dev/datatypes/markdown",ge.RESOURCEARRAY="https://atomicdata.dev/datatypes/resourceArray",ge.SLUG="https://atomicdata.dev/datatypes/slug",ge.STRING="https://atomicdata.dev/datatypes/string",ge.TIMESTAMP="https://atomicdata.dev/datatypes/timestamp",ge.UNKNOWN="unknown-datatype";var Se=function(t){switch(t){case lr.datatypes.atomicUrl:return be.ATOMIC_URL;case lr.datatypes.boolean:return be.BOOLEAN;case lr.datatypes.date:return be.DATE;case lr.datatypes.float:return be.FLOAT;case lr.datatypes.integer:return be.INTEGER;case lr.datatypes.markdown:return be.MARKDOWN;case lr.datatypes.resourceArray:return be.RESOURCEARRAY;case lr.datatypes.slug:return be.SLUG;case lr.datatypes.string:return be.STRING;case lr.datatypes.timestamp:return be.TIMESTAMP;default:return be.UNKNOWN}},xe=/^[a-z0-9]+(?:-[a-z0-9]+)*$/,Ae=/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/,Ee=function(t,e){var r=null;if(void 0===t)throw new Error("Value is undefined, expected ".concat(e));switch(e){case be.STRING:if(!je(t)){r="Not a string";break}break;case be.SLUG:if(!je(t)){r="Not a slug, not even a string";break}null===t.match(xe)&&(r="Not a valid slug. Only lowercase letters and numbers with dashes `-` between them");break;case be.ATOMIC_URL:if(!je(t)){r="Not a string. Should be a URL";break}P.tryValidSubject(t);break;case be.RESOURCEARRAY:if(!Re(t)){r="Not an array";break}t.map((function(t,e){try{P.tryValidSubject(t)}catch(t){var r=new Error("Invalid URL");throw r.index=e,r}}));break;case be.INTEGER:if(!Pe(t)){r="Not a number";break}t%1!=0&&(r="Not an integer");break;case be.DATE:if(!je(t)){r="Not a string";break}null===t.match(Ae)&&(r="Not a date string: YYYY-MM-DD")}if(null!==r)throw new Error(r)};function Re(t){return"[object Array]"===Object.prototype.toString.call(t)}function je(t){return"string"==typeof t}function Pe(t){return"number"==typeof t}(ve={})[be.STRING]="String",ve[be.SLUG]="Slug",ve[be.MARKDOWN]="Markdown",ve[be.INTEGER]="Integer",ve[be.FLOAT]="Float",ve[be.BOOLEAN]="Boolean",ve[be.DATE]="Date",ve[be.TIMESTAMP]="Timestamp",ve[be.ATOMIC_URL]="Resource",ve[be.RESOURCEARRAY]="ResourceArray",ve[be.UNKNOWN]="Unknown";var Oe,Ue=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},ke=function(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))},Ce=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_e=function(){function t(){this.parsedResources=[]}return t.prototype.parseObject=function(t,e){return this.parsedResources=[],[this.parseJsonADResource(t,e),ke([],Ue(this.parsedResources),!1)]},t.prototype.parseArray=function(t){return this.parsedResources=[],[this.parseJsonADArray(t),ke([],Ue(this.parsedResources),!1)]},t.prototype.parseValue=function(t,e){return this.parsedResources=[],[this.parseJsonAdResourceValue(t,e),ke([],Ue(this.parsedResources),!1)]},t.prototype.parseJsonADResource=function(t,e){var r,o,n=this;void 0===e&&(e=Ne);var i=new Me(e);this.parsedResources.push(i);try{var s=function(t,e){if("@id"===t){if("string"!=typeof e)throw new Error("'@id' field must be a string");if("undefined"!==i.getSubject()&&i.getSubject()!==Ne&&e!==i.getSubject())throw new Error("Resource has wrong subject in @id. Received subject was ".concat(e,", expected ").concat(i.getSubject(),"."));return i.setSubject(e),"continue"}try{if(Re(e)){var r=e.map((function(e){return n.parseJsonAdResourceValue(e,t)}));i.setUnsafe(t,r)}else if("string"==typeof e)i.setUnsafe(t,e);else if("number"==typeof e)i.setUnsafe(t,e);else if("boolean"==typeof e)i.setUnsafe(t,e);else{var o=a.parseJsonAdResourceValue(e,t);i.setUnsafe(t,o)}}catch(r){var s="Failed creating value ".concat(e," for key ").concat(t," in resource ").concat(i.getSubject()),c="".concat(s,". ").concat(r.message);throw new Error(c)}},a=this;try{for(var c=Ce(Object.entries(t)),u=c.next();!u.done;u=c.next()){var l=Ue(u.value,2);s(l[0],l[1])}}catch(t){r={error:t}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}i.loading=!1,i.hasClasses(lr.classes.error)&&(i.error=we.fromResource(i))}catch(t){throw t.message="Failed parsing JSON "+t.message,i.setError(t),i.loading=!1,t}return i},t.prototype.parseJsonAdResourceValue=function(t,e){if("string"==typeof t)return t;if((null==t?void 0:t.constructor)==={}.constructor){if(Object.keys(t).includes("@id")){var r=t["@id"];return this.parseJsonADResource(t),r}return t}throw new Error("Value ".concat(t," in ").concat(e," not a string or a nested Resource"))},t.prototype.parseJsonADArray=function(t){var e,r,o=[];try{try{for(var n=Ce(t),i=n.next();!i.done;i=n.next()){var s=i.value,a=this.parseJsonADResource(s);o.push(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}}catch(t){throw t.message="Failed parsing JSON "+t.message,t}return o},t}(),Be=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},Te=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},Fe=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},Ie=function(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))},Ne="unknown-subject",Me=function(){function t(t,e){if(this.__internalObject=this,this.hasQueue=!1,"string"!=typeof t)throw new Error("Invalid subject given to resource, must be a string, found "+t);this.new=!!e,this.loading=!1,this.subject=t,this.propvals=new Map,this.appliedCommitSignatures=new Set,this.commitBuilder=new ne(t)}return Object.defineProperty(t.prototype,"title",{get:function(){var t,e,r;return null!==(r=null!==(e=null!==(t=this.get(cr.name))&&void 0!==t?t:this.get(cr.shortname))&&void 0!==e?e:this.get(cr.file.filename))&&void 0!==r?r:this.subject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"props",{get:function(){var t,e,r={};try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.propvals.keys()),n=o.next();!n.done;n=o.next()){var i=n.value,a=s(i);a&&(r[a]=this.get(i))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return r},enumerable:!1,configurable:!0}),t.prototype.equals=function(t){return this===t.__internalObject||this.getSubject()===t.getSubject()&&this.new===t.new&&this.error===t.error&&this.loading===t.loading&&JSON.stringify(Array.from(this.propvals.entries()))===JSON.stringify(Array.from(t.propvals.entries()))&&JSON.stringify(Array.from(this.commitBuilder.set.entries()))===JSON.stringify(Array.from(t.commitBuilder.set.entries()))},t.prototype.canWrite=function(t,e,r){return Be(this,void 0,void 0,(function(){var o,n;return Te(this,(function(i){switch(i.label){case 0:return o=this.get(cr.write),e?o&&ar(o).includes(e)||o&&ar(o).includes(ur.publicAgent)?[2,[!0,void 0]]:(n=this.get(cr.parent))?n===e?[2,[!0,void 0]]:r===n?(console.warn("Circular parent",r),[2,[!0,"Circular parent in ".concat(this.getSubject())]]):[4,t.getResourceAsync(n)]:[2,[!1,"No write right or parent in ".concat(this.getSubject())]]:[2,[!1,"No agent given"]];case 1:return[4,i.sent().canWrite(t,e,this.getSubject())];case 2:return[2,i.sent()]}}))}))},t.prototype.clone=function(){var e=new t(this.subject);return e.propvals=structuredClone(this.propvals),e.loading=this.loading,e.new=this.new,e.error=structuredClone(this.error),e.commitError=this.commitError,e.commitBuilder=this.commitBuilder.clone(),e.appliedCommitSignatures=this.appliedCommitSignatures,e},t.prototype.isReady=function(){return!this.loading&&void 0===this.error},t.prototype.get=function(t){return this.propvals.get(t)},t.prototype.getSubjects=function(t){return this.getArray(t).map((function(t){return"string"==typeof t?t:t["@id"]}))},t.prototype.getArray=function(t){var e;return ar(null!==(e=this.propvals.get(t))&&void 0!==e?e:[])},t.prototype.getClasses=function(){return this.getSubjects(cr.isA)},t.prototype.hasClasses=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.every((function(e){return t.getClasses().includes(e)}))},t.prototype.removeClasses=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this.set(cr.isA,this.getClasses().filter((function(t){return!e.includes(t)})),t)},t.prototype.addClasses=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var o=new Set(Ie(Ie([],Fe(this.getClasses()),!1),Fe(e),!1));return this.set(cr.isA,Array.from(o),t)},t.prototype.hasUnsavedChanges=function(){return this.commitBuilder.hasUnsavedChanges()},t.prototype.getCommitsCollection=function(){var t=new URL(this.subject);return t.pathname="/commits",t.searchParams.append("property",lr.properties.commit.subject),t.searchParams.append("value",this.subject),t.searchParams.append("sort_by",lr.properties.commit.createdAt),t.searchParams.append("include_nested","true"),t.searchParams.append("page_size","9999"),t.toString()},t.prototype.getChildrenCollection=function(){var t=new URL(this.subject);return t.pathname="/query",t.searchParams.set("property",cr.parent),t.searchParams.set("value",this.subject),t.toString()},t.prototype.getHistory=function(e,r){return Be(this,void 0,void 0,(function(){var o,n,i,s,a,c,u,l;return Te(this,(function(p){switch(p.label){case 0:return[4,e.fetchResourceFromServer(this.getCommitsCollection())];case 1:o=p.sent(),n=o.get(cr.collection.members),i=[],s=new t(this.subject),a=0,p.label=2;case 2:return a<n.length?[4,e.getResourceAsync(n[a])]:[3,6];case 3:return c=p.sent(),u=ue(c),l=pe(s.clone(),u),i.push({commit:u,resource:l}),s=l,r&&a%30==0?(r(Math.round(a/n.length*100)),[4,De()]):[3,5];case 4:p.sent(),p.label=5;case 5:return a++,[3,2];case 6:return[2,i]}}))}))},t.prototype.getSubject=function(){return this.subject},t.prototype.getSubjectNoParams=function(){var t=new URL(this.subject);return t.origin+t.pathname},t.prototype.getPropVals=function(){return this.propvals},t.prototype.getRights=function(t){return Be(this,void 0,void 0,(function(){var e,r,o,n=this;return Te(this,(function(i){switch(i.label){case 0:return e=[],this.getSubjects(cr.write).forEach((function(t){e.push({for:t,type:Oe.WRITE,setIn:n.subject})})),this.getSubjects(cr.read).forEach((function(t){e.push({for:t,type:Oe.READ,setIn:n.subject})})),(r=this.get(cr.parent))?r===this.getSubject()?(console.warn("Circular parent",r),[2,e]):[4,t.getResourceAsync(r)]:[3,3];case 1:return[4,i.sent().getRights(t)];case 2:o=i.sent(),e.push.apply(e,Ie([],Fe(o),!1)),i.label=3;case 3:return[2,e]}}))}))},t.prototype.isUnauthorized=function(){return!!this.error&&me(this.error)},t.prototype.destroy=function(t,e){return Be(this,void 0,void 0,(function(){var r,o,n;return Te(this,(function(i){switch(i.label){case 0:if(this.new)return t.removeResource(this.getSubject()),[2];if((r=new ne(this.getSubject())).setDestroy(!0),void 0===e&&(e=t.getAgent()),void 0===(null==e?void 0:e.subject))throw new Error("No agent has been set or passed, you cannot delete this.");return[4,r.sign(e.privateKey,e.subject)];case 1:return o=i.sent(),n=new URL(this.getSubject()).origin+"/commit",[4,t.postCommit(o,n)];case 2:return i.sent(),t.removeResource(this.getSubject()),[2]}}))}))},t.prototype.pushPropVal=function(t,e,r){var o,n,i=this,s=null!==(n=this.get(t))&&void 0!==n?n:[];r&&(e=e.filter((function(t){return!s.includes(t)})).filter((function(e){var r;return!(null===(r=i.commitBuilder.push[t])||void 0===r?void 0:r.includes(e))})).filter((function(t,e,r){return r.indexOf(t)===e}))),(o=this.commitBuilder).addPushAction.apply(o,Ie([t],Fe(e),!1)),this.propvals.set(t,Ie(Ie([],Fe(s),!1),Fe(e),!1))},t.prototype.removePropVal=function(t){this.propvals.delete(t),this.commitBuilder.addRemoveAction(t)},t.prototype.removePropValLocally=function(t){this.propvals.delete(t)},t.prototype.save=function(t,e){var r,o,n;return Be(this,void 0,void 0,(function(){var i,s,a,c,u,l,p,h,d,f,y;return Te(this,(function(m){switch(m.label){case 0:if(!this.commitBuilder.hasUnsavedChanges())return console.warn("No changes to ".concat(this.subject,", not saving")),[2,void 0];if(!(i=null!==(r=t.getAgent())&&void 0!==r?r:e))throw new Error("No agent has been set or passed, you cannot save.");return this.hasQueue?[2]:this.isParentNew(t)?(t.batchResource(this.getSubject()),[2]):this.inProgressCommit?(this.hasQueue=!0,[4,this.inProgressCommit]):[3,2];case 1:return m.sent(),this.hasQueue=!1,this.inProgressCommit=void 0,[2,this.save(t,e)];case 2:return(s=null===(o=this.get(cr.commit.lastCommit))||void 0===o?void 0:o.toString())&&this.commitBuilder.setPreviousCommit(s),a=this.new,c=function(){},this.inProgressCommit=new Promise((function(t){c=function(){t()}})),u=this.commitBuilder.clone(),this.commitBuilder=new ne(this.getSubject()),[4,u.sign(i.privateKey,i.subject)];case 3:l=m.sent(),this.appliedCommitSignatures.add(l.signature),this.loading=!1,this.new=!1,p=new URL(this.getSubject()).origin+"/commit",m.label=4;case 4:return m.trys.push([4,8,,12]),this.commitError=void 0,t.addResources(this,{skipCommitCompare:!0}),[4,t.postCommit(l,p)];case 5:return h=m.sent(),this.setUnsafe(cr.commit.lastCommit,h.id),t.notifyResourceSaved(this),a?(t.subscribeWebSocket(this.subject),[4,t.saveBatchForParent(this.getSubject())]):[3,7];case 6:m.sent(),m.label=7;case 7:return c(),[2,h.id];case 8:return(d=m.sent()).message.includes("previousCommit")?(console.warn("previousCommit missing or mismatch, retrying..."),[4,t.fetchResourceFromServer(this.getSubject())]):[3,11];case 9:return f=m.sent(),(y=null===(n=f.get(cr.commit.lastCommit))||void 0===n?void 0:n.toString())&&this.setUnsafe(cr.commit.lastCommit,y),c(),[4,this.save(t,i)];case 10:return[2,m.sent()];case 11:throw this.commitBuilder=u,this.commitError=d,t.addResources(this,{skipCommitCompare:!0}),c(),d;case 12:return[2]}}))}))},t.prototype.set=function(t,e,r,o){return void 0===o&&(o=!0),Be(this,void 0,void 0,(function(){var n;return Te(this,(function(i){switch(i.label){case 0:return r.isOffline()&&(console.warn("Offline, not validating"),o=!1),o?[4,r.getProperty(t)]:[3,2];case 1:n=i.sent(),Ee(e,n.datatype),i.label=2;case 2:return void 0===e?(this.removePropVal(t),[2]):(this.propvals.set(t,e),this.commitBuilder.addSetAction(t,e),[2])}}))}))},t.prototype.setUnsafe=function(t,e){this.propvals.set(t,e)},t.prototype.setError=function(t){this.error=t},t.prototype.setSubject=function(t){P.tryValidSubject(t),this.commitBuilder.setSubject(t),this.subject=t},t.prototype.equalsCurrentValue=function(t,e){var r=this.get(t);return e===Object(e)?JSON.stringify(r)===JSON.stringify(e):r===e},t.prototype.isParentNew=function(t){var e=this.propvals.get(a.properties.parent);return!!e&&t.getResourceLoading(e).new},t}();!function(t){t.READ="read",t.WRITE="write"}(Oe||(Oe={}));var De=function(){return new Promise((function(t){return setTimeout(t)}))},Le=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},ze=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},We=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},Ge=function(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))},qe=function(){function t(){this.subscriptions=new Map}return t.prototype.register=function(t,e){var r,o=null!==(r=this.subscriptions.get(t))&&void 0!==r?r:new Set;return o.add(e),this.subscriptions.set(t,o),function(){o.delete(e)}},t.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return Le(this,void 0,void 0,(function(){var r,o,n=this;return ze(this,(function(i){switch(i.label){case 0:return this.subscriptions.has(t)?(r=this.subscriptions.get(t),o=function(t){return Le(n,void 0,void 0,(function(){return ze(this,(function(r){return[2,t.apply(void 0,Ge([],We(e),!1))]}))}))},r?[4,Promise.allSettled(Ge([],We(r),!1).map((function(t){return o(t)})))]:[2]):[2];case 1:return i.sent(),[2]}}))}))},t.prototype.hasSubscriptions=function(t){return this.subscriptions.has(t)},t}(),He=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},Ve=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},Je=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s};function Ke(t,e){var r=new URL(t);"http:"===r.protocol?r.protocol="ws":r.protocol="wss",r.pathname="/ws";var o=new WebSocket(r.toString());return o.onopen=function(t){return function(t,e){Ye(e,t).then((function(){var e,r;try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t.subscribers.keys()),n=o.next();!n.done;n=o.next()){var i=n.value;t.subscribeWebSocket(i)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}}))}(e,o)},o.onmessage=function(t){return function(t,e){if(t.data.startsWith("COMMIT "))he(t.data.slice(7),e);else if(t.data.startsWith("ERROR "))e.notifyError(t.data.slice(6));else if(t.data.startsWith("RESOURCE ")){var r=Ze(t);e.addResources(r)}else console.warn("Unknown websocket message:",t)}(t,e)},o.onerror=$e,o}function $e(t){console.error("websocket error:",t)}function Ze(t){var e=t.data.slice(9),r=JSON.parse(e),o=new _e,n=Je(o.parseObject(r),2);return n[0],n[1]}function Ye(t,e,r){var o;return void 0===r&&(r=!1),He(this,void 0,void 0,(function(){var n,i,s=this;return Ve(this,(function(a){switch(a.label){case 0:return(n=e.getAgent())&&n.subject?!t.url.startsWith("ws://localhost")&&(null===(o=null==n?void 0:n.subject)||void 0===o?void 0:o.startsWith("http://localhost"))?(console.warn("Can't authenticate localhost Agent over websocket with remote server ".concat(t.url," because the server will nog be able to retrieve your Agent and verify your public key.")),[2]):[4,y(t.url,n)]:[2];case 1:return i=a.sent(),t.send("AUTHENTICATE "+JSON.stringify(i)),r&&this.resources.forEach((function(t){(t.isUnauthorized()||t.loading)&&s.fetchResourceFromServer(t.getSubject())})),[2]}}))}))}function Qe(t,e){return He(this,void 0,void 0,(function(){return Ve(this,(function(r){return[2,new Promise((function(r,o){t.addEventListener("message",(function n(i){var s=setTimeout((function(){t.removeEventListener("message",n),o(new Error('Request for subject "'.concat(e,'" timed out after ').concat(5e3,"ms.")))}),5e3);i.data.startsWith("RESOURCE ")&&Ze(i).forEach((function(o){o.getSubject()===e&&(clearTimeout(s),t.removeEventListener("message",n),r(o))}))})),t.send("GET "+e)}))]}))}))}var Xe,tr=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},er=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},rr=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},or=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},nr=function(t,e,r){if(r||2===arguments.length)for(var o,n=0,i=e.length;n<i;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};!function(t){t.ResourceSaved="resource-saved",t.ResourceRemoved="resource-removed",t.ResourceManuallyCreated="resource-manually-created",t.AgentChanged="agent-changed",t.Error="error"}(Xe||(Xe={}));var ir=function(){return"undefined"!=typeof WebSocket},sr=function(){function t(t){void 0===t&&(t={}),this.batchedResources=new Map,this.eventManager=new qe,this._resources=new Map,this.webSockets=new Map,this.subscribers=new Map,t.serverUrl&&this.setServerUrl(t.serverUrl),t.agent&&this.setAgent(t.agent),this.client=new P(this.injectedFetch),this.getAgent=this.getAgent.bind(this),this.setAgent=this.setAgent.bind(this)}return Object.defineProperty(t.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),t.prototype.injectFetch=function(t){this.injectedFetch=t,this.client.setFetch(t)},t.prototype.addResources=function(t,e){var r,o;try{for(var n=rr(Array.isArray(t)?t:[t]),i=n.next();!i.done;i=n.next()){var s=i.value;this.addResource(s,null!=e?e:{})}}catch(t){r={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}},t.prototype.addResource=function(t,e){var r=e.skipCommitCompare;if(t.get(lr.properties.incomplete)){var o=this.resources.get(t.getSubject());if(o&&!o.loading)return}if(!r){var n=this.resources.get(t.getSubject());if(n&&!n.hasClasses(u.classes.collection)&&!n.loading&&!n.new&&n.get(c.properties.lastCommit)===t.get(c.properties.lastCommit))return}this.resources.set(t.getSubject(),t.__internalObject),this.notify(t.__internalObject)},t.prototype.newResource=function(t){return void 0===t&&(t={}),tr(this,void 0,void 0,(function(){var e,r,o,n,i,s,c,u,l,p,h,d,f,y,m;return er(this,(function(v){switch(v.label){case 0:return e=t.subject,r=t.parent,o=t.isA,n=t.propVals,i=Array.isArray(o)?o:[o],s=null!=e?e:this.createSubject(i[0],r),c=this.getResourceLoading(s,{newResource:!0}),i[0]?[4,c.addClasses.apply(c,nr([this],or(i),!1))]:[3,2];case 1:v.sent(),v.label=2;case 2:return[4,c.set(a.properties.parent,null!=r?r:this.serverUrl,this)];case 3:if(v.sent(),!n)return[3,11];v.label=4;case 4:v.trys.push([4,9,10,11]),u=rr(Object.entries(n)),l=u.next(),v.label=5;case 5:return l.done?[3,8]:(p=or(l.value,2),h=p[0],d=p[1],[4,c.set(h,d,this)]);case 6:v.sent(),v.label=7;case 7:return l=u.next(),[3,5];case 8:return[3,11];case 9:return f=v.sent(),y={error:f},[3,11];case 10:try{l&&!l.done&&(m=u.return)&&m.call(u)}finally{if(y)throw y.error}return[7];case 11:return[2,c]}}))}))},t.prototype.checkSubjectTaken=function(t){var e;return tr(this,void 0,void 0,(function(){var r,o,n;return er(this,(function(i){switch(i.label){case 0:if((null==(r=this.resources.get(t))?void 0:r.isReady())&&!(null==r?void 0:r.new))return[2,!0];i.label=1;case 1:return i.trys.push([1,3,,4]),o=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,[4,this.client.fetchResourceHTTP(t,{method:"GET",signInfo:o})];case 2:return n=i.sent().createdResources,(null===(e=n.find((function(e){return e.getSubject()===t})))||void 0===e?void 0:e.isReady())?[2,!0]:[3,4];case 3:return i.sent(),[3,4];case 4:return[2,!1]}}))}))},t.prototype.buildUniqueSubjectFromParts=function(t,e){return tr(this,void 0,void 0,(function(){var r,o;return er(this,(function(n){return r=t.join("/"),o=null!=e?e:this.getServerUrl(),[2,this.findAvailableSubject(r,o)]}))}))},t.prototype.createSubject=function(t,e){var r=this.randomPart();return t=t||"things",e?"".concat(e,"/").concat(t,"/").concat(r):"".concat(this.getServerUrl(),"/").concat(t,"/").concat(r)},t.prototype.fetchResourceFromServer=function(t,e){return void 0===e&&(e={}),tr(this,void 0,void 0,(function(){var r,o,n,i;return er(this,(function(s){switch(s.label){case 0:return e.setLoading&&((r=new Me(t)).loading=!0,this.addResources(r)),o=this.getWebSocketForSubject(t),e.fromProxy||e.noWebSocket||!ir()||(null==o?void 0:o.readyState)!==WebSocket.OPEN?[3,2]:[4,Qe(o,t)];case 1:return s.sent(),[3,4];case 2:return n=this.agent?{agent:this.agent,serverURL:this.getServerUrl()}:void 0,[4,this.client.fetchResourceHTTP(t,{from:e.fromProxy?this.getServerUrl():void 0,method:e.method,body:e.body,signInfo:n})];case 3:i=s.sent().createdResources,this.addResources(i),s.label=4;case 4:return[2,this.resources.get(t)]}}))}))},t.prototype.getAllSubjects=function(){return Array.from(this.resources.keys())},t.prototype.getDefaultWebSocket=function(){return this.webSockets.get(this.getServerUrl())},t.prototype.getWebSocketForSubject=function(t){var e=new URL(t),r=this.webSockets.get(e.origin);if(r)return r;"undefined"!=typeof window&&this.webSockets.set(e.origin,Ke(e.origin,this))},t.prototype.getServerUrl=function(){return this.serverUrl},t.prototype.getAgent=function(){var t;return null!==(t=this.agent)&&void 0!==t?t:void 0},t.prototype.getResourceLoading=function(t,e){if(void 0===t&&(t=Ne),void 0===e&&(e={}),t===Ne||null===t)return new Me(Ne,e.newResource);var r=this.resources.get(t);return r?(e.allowIncomplete||!1!==r.loading||r.get(lr.properties.incomplete)&&(r.loading=!0,this.addResources(r),this.fetchResourceFromServer(t,e)),r):((r=new Me(t,e.newResource)).loading=!0,this.addResources(r),e.newResource||this.fetchResourceFromServer(t,e),r)},t.prototype.getResourceAsync=function(t){return tr(this,void 0,void 0,(function(){var e,r=this;return er(this,(function(o){return(e=this.resources.get(t))&&e.isReady()?[2,e]:e&&!e.isReady()?[2,new Promise((function(e,o){var n=function(o){r.unsubscribe(t,n),e(o)};r.subscribe(t,n),setTimeout((function(){r.unsubscribe(t,n),o(new Error('Async Request for subject "'.concat(t,'" timed out after ').concat(5e3,"ms.")))}),5e3)}))]:[2,this.fetchResourceFromServer(t)]}))}))},t.prototype.getProperty=function(t){var e;return tr(this,void 0,void 0,(function(){var r,o,n,i,s;return er(this,(function(a){switch(a.label){case 0:return[4,this.getResourceAsync(t)];case 1:if(void 0===(r=a.sent()))throw Error("Property ".concat(t," is not found"));if(r.error)throw Error("Property ".concat(t," cannot be loaded: ").concat(r.error));if(void 0===(o=r.get(lr.properties.datatype)))throw Error("Property ".concat(t," has no datatype: ").concat(r.getPropVals()));if(void 0===(n=r.get(lr.properties.shortname)))throw Error("Property ".concat(t," has no shortname: ").concat(r.getPropVals()));if(void 0===(i=r.get(lr.properties.description)))throw Error("Property ".concat(t," has no description: ").concat(r.getPropVals()));return s=null===(e=r.get(lr.properties.classType))||void 0===e?void 0:e.toString(),[2,{subject:t,classType:s,shortname:n.toString(),description:i.toString(),datatype:Se(o.toString())}]}}))}))},t.prototype.notifyError=function(t){var e=t instanceof Error?t:new Error(t);if(!this.eventManager.hasSubscriptions(Xe.Error))throw e;this.eventManager.emit(Xe.Error,e)},t.prototype.isOffline=function(){var t;return!!S()&&!(null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.onLine)},t.prototype.notifyResourceSaved=function(t){return tr(this,void 0,void 0,(function(){return er(this,(function(e){switch(e.label){case 0:return[4,this.eventManager.emit(Xe.ResourceSaved,t)];case 1:return e.sent(),[2]}}))}))},t.prototype.notifyResourceManuallyCreated=function(t){return tr(this,void 0,void 0,(function(){return er(this,(function(e){switch(e.label){case 0:return[4,this.eventManager.emit(Xe.ResourceManuallyCreated,t)];case 1:return e.sent(),[2]}}))}))},t.prototype.parseMetaTags=function(){var t=this,e=document.querySelectorAll('meta[property="json-ad-initial"]'),r=new _e;e.forEach((function(e){var o=e.getAttribute("content");if(null!==o){var n=JSON.parse(atob(o)),i=or(r.parseObject(n),2),s=(i[0],i[1]);t.addResources(s)}}))},t.prototype.preloadPropsAndClasses=function(){return tr(this,void 0,void 0,(function(){var t,e;return er(this,(function(r){switch(r.label){case 0:return t=new URL("/classes",this.serverUrl),e=new URL("/properties",this.serverUrl),t.searchParams.set("include_external","true"),e.searchParams.set("include_external","true"),t.searchParams.set("include_nested","true"),e.searchParams.set("include_nested","true"),t.searchParams.set("page_size","999"),e.searchParams.set("page_size","999"),[4,Promise.all([this.fetchResourceFromServer(t.toString()),this.fetchResourceFromServer(e.toString())])];case 1:return r.sent(),[2]}}))}))},t.prototype.postToServer=function(t,e){return tr(this,void 0,void 0,(function(){return er(this,(function(r){return[2,this.fetchResourceFromServer(t,{body:e,noWebSocket:!0,method:"POST"})]}))}))},t.prototype.removeResource=function(t){var e=this.resources.get(t);e&&(this.resources.delete(t),this.eventManager.emit(Xe.ResourceRemoved,e))},t.prototype.renameSubject=function(t,e){var r;return tr(this,void 0,void 0,(function(){var o,n;return er(this,(function(i){switch(i.label){case 0:return P.tryValidSubject(e),o=t.getSubject(),[4,this.checkSubjectTaken(e)];case 1:if(i.sent())throw Error("New subject name is already taken: ".concat(e));return t.setSubject(e),n=null!==(r=this.subscribers.get(o))&&void 0!==r?r:[],this.subscribers.set(e,n),this.removeResource(o),this.addResources(t),[2]}}))}))},t.prototype.setAgent=function(t){var e=this;this.agent=t,t&&t.subject?(S()&&g(this.serverUrl,t),this.webSockets.forEach((function(t){t.readyState===t.OPEN?Ye(t,e,!0):t.onopen=function(){Ye(t,e,!0)}}))):S()&&(document.cookie="".concat(b,"=;Max-Age=-99999999")),this.eventManager.emit(Xe.AgentChanged,t)},t.prototype.setServerUrl=function(t){if(P.tryValidSubject(t),"/"===t.substring(-1))throw Error("baseUrl should not have a trailing slash");this.serverUrl=t,ir()&&this.openWebSocket(t)},t.prototype.openWebSocket=function(t){if(ir()){if(this.webSockets.has(t))return;this.webSockets.set(t,Ke(t,this))}else console.warn("WebSockets not supported, no window available")},t.prototype.subscribe=function(t,e){var r=this;if(void 0===t)throw Error("Cannot subscribe to undefined subject");var o=this.subscribers.get(t);return void 0===o&&(this.subscribeWebSocket(t),o=[]),o.push(e),this.subscribers.set(t,o),function(){r.unsubscribe(t,e)}},t.prototype.subscribeWebSocket=function(t){if(t!==Ne)try{var e=this.getWebSocketForSubject(t);1===(null==e?void 0:e.readyState)&&(null==e||e.send("SUBSCRIBE ".concat(t)))}catch(t){console.error(t)}},t.prototype.unSubscribeWebSocket=function(t){var e;if(t!==Ne)try{null===(e=this.getDefaultWebSocket())||void 0===e||e.send("UNSUBSCRIBE ".concat(t))}catch(t){console.error(t)}},t.prototype.unsubscribe=function(t,e){if(void 0!==t){var r=this.subscribers.get(t);r&&(r=null==r?void 0:r.filter((function(t){return t!==e})),this.subscribers.set(t,r))}},t.prototype.on=function(t,e){return this.eventManager.register(t,e)},t.prototype.uploadFiles=function(t,e){return tr(this,void 0,void 0,(function(){var r,o;return er(this,(function(n){switch(n.label){case 0:if(!(r=this.getAgent()))throw Error("No agent set, cannot upload files");return[4,this.client.uploadFiles(t,this.getServerUrl(),r,e)];case 1:return o=n.sent(),this.addResources(o),[2,o.map((function(t){return t.getSubject()}))]}}))}))},t.prototype.postCommit=function(t,e){return tr(this,void 0,void 0,(function(){return er(this,(function(r){return[2,this.client.postCommit(t,e)]}))}))},t.prototype.getResourceAncestry=function(t){return tr(this,void 0,void 0,(function(){var e,r,o;return er(this,(function(n){switch(n.label){case 0:e=[t.getSubject()],(r=t.get(lr.properties.parent))&&e.push(r),n.label=1;case 1:return r?[4,this.getResourceAsync(r)]:[3,3];case 2:if(o=n.sent()){if(r=o.get(lr.properties.parent),e.includes(r))throw new Error("Resource ".concat(t.getSubject()," ancestry is cyclical. ").concat(r," is already in the ancestry}"));e.push(r)}return[3,1];case 3:return[2,e]}}))}))},t.prototype.clientSideQuery=function(t){return Array.from(this.resources.values()).filter(t)},t.prototype.batchResource=function(t){var e=this._resources.get(t);if(!e)throw new Error("Resource ".concat(t," can not be saved because it is not in the store."));var r=e.get(a.properties.parent);if(void 0===r)throw new Error("Resource ".concat(t," can not be added to a batch because it's missing a parent."));this.batchedResources.has(r)?this.batchedResources.get(r).add(t):this.batchedResources.set(r,new Set([t]))},t.prototype.saveBatchForParent=function(t){return tr(this,void 0,void 0,(function(){var e,r,o,n,i,s,a,c;return er(this,(function(u){switch(u.label){case 0:if(!(e=this.batchedResources.get(t)))return[2];u.label=1;case 1:u.trys.push([1,6,7,8]),r=rr(e),o=r.next(),u.label=2;case 2:return o.done?[3,5]:(n=o.value,[4,null==(i=this._resources.get(n))?void 0:i.save(this)]);case 3:u.sent(),u.label=4;case 4:return o=r.next(),[3,2];case 5:return[3,8];case 6:return s=u.sent(),a={error:s},[3,8];case 7:try{o&&!o.done&&(c=r.return)&&c.call(r)}finally{if(a)throw a.error}return[7];case 8:return this.batchedResources.delete(t),[2]}}))}))},t.prototype.randomPart=function(){return Math.random().toString(36).substring(2)},t.prototype.findAvailableSubject=function(t,e,r){return void 0===r&&(r=!0),tr(this,void 0,void 0,(function(){var o,n;return er(this,(function(i){switch(i.label){case 0:return o="".concat(e,"/").concat(t),r||(n=this.randomPart(),o+="-".concat(n)),[4,this.checkSubjectTaken(o)];case 1:return i.sent()?[2,this.findAvailableSubject(t,e,!1)]:[2,o]}}))}))},t.prototype.notify=function(t){return tr(this,void 0,void 0,(function(){var e,r,o=this;return er(this,(function(n){return e=t.getSubject(),void 0===(r=this.subscribers.get(e))||Promise.allSettled(r.map((function(e){return tr(o,void 0,void 0,(function(){return er(this,(function(r){return[2,e(t)]}))}))}))),[2]}))}))},t}();function ar(t){if(void 0===t)throw new Error("Not an array: ".concat(t,", is ").concat(typeof t));if(t.constructor===Array)return t;throw new Error("Not an array: ".concat(t,", is a ").concat(typeof t))}var cr={allowsOnly:"https://atomicdata.dev/properties/allowsOnly",getAll:"https://atomicdata.dev/properties/?page_size=999",children:"https://atomicdata.dev/properties/children",classType:"https://atomicdata.dev/properties/classtype",createdBy:"https://atomicdata.dev/properties/createdBy",datatype:"https://atomicdata.dev/properties/datatype",description:"https://atomicdata.dev/properties/description",drives:"https://atomicdata.dev/properties/drives",incomplete:"https://atomicdata.dev/properties/incomplete",isA:"https://atomicdata.dev/properties/isA",isDynamic:"https://atomicdata.dev/properties/isDynamic",name:"https://atomicdata.dev/properties/name",parent:"https://atomicdata.dev/properties/parent",paymentPointer:"https://atomicdata.dev/properties/paymentPointer",read:"https://atomicdata.dev/properties/read",recommends:"https://atomicdata.dev/properties/recommends",requires:"https://atomicdata.dev/properties/requires",shortname:"https://atomicdata.dev/properties/shortname",subResources:"https://atomicdata.dev/properties/subresources",write:"https://atomicdata.dev/properties/write",displayStyle:"https://atomicdata.dev/property/display-style",publishedAt:"https://atomicdata.dev/properties/published-at",agent:{publicKey:"https://atomicdata.dev/properties/publicKey"},collection:{members:"https://atomicdata.dev/properties/collection/members",currentPage:"https://atomicdata.dev/properties/collection/currentPage",pageSize:"https://atomicdata.dev/properties/collection/pageSize",property:"https://atomicdata.dev/properties/collection/property",totalMembers:"https://atomicdata.dev/properties/collection/totalMembers",totalPages:"https://atomicdata.dev/properties/collection/totalPages",value:"https://atomicdata.dev/properties/collection/value"},commit:{subject:"https://atomicdata.dev/properties/subject",createdAt:"https://atomicdata.dev/properties/createdAt",lastCommit:"https://atomicdata.dev/properties/lastCommit",previousCommit:"https://atomicdata.dev/properties/previousCommit",signer:"https://atomicdata.dev/properties/signer",set:"https://atomicdata.dev/properties/set",push:"https://atomicdata.dev/properties/push",remove:"https://atomicdata.dev/properties/remove",destroy:"https://atomicdata.dev/properties/destroy",signature:"https://atomicdata.dev/properties/signature"},document:{elements:"https://atomicdata.dev/properties/documents/elements"},endpoint:{parameters:"https://atomicdata.dev/properties/endpoint/parameters",results:"https://atomicdata.dev/properties/endpoint/results"},search:{query:"https://atomicdata.dev/properties/search/query",limit:"https://atomicdata.dev/properties/search/limit",property:"https://atomicdata.dev/properties/search/property"},redirect:{destination:"https://atomicdata.dev/properties/destination",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent"},invite:{agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write"},file:{filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments"},chatRoom:{messages:"https://atomicdata.dev/properties/messages",nextPage:"https://atomicdata.dev/properties/nextPage",replyTo:"https://atomicdata.dev/properties/replyTo"},bookmark:{url:"https://atomicdata.dev/property/url",preview:"https://atomicdata.dev/property/preview",imageUrl:"https://atomicdata.dev/properties/imageUrl"},constraints:{max:"https://atomicdata.dev/properties/max",min:"https://atomicdata.dev/properties/min",maxFloat:"https://atomicdata.dev/properties/maxFloat",minFloat:"https://atomicdata.dev/properties/minFloat",numberFormatting:"https://atomicdata.dev/properties/numberFormatting",decimalPlaces:"https://atomicdata.dev/properties/decimalPlaces",dateFormat:"https://atomicdata.dev/properties/dateFormat"},table:{tableColumnWidths:"https://atomicdata.dev/properties/tableColumnWidths"},ontology:{customNodePositioning:"https://atomicdata.dev/properties/custom-node-positioning"},color:"https://atomicdata.dev/properties/color",emoji:"https://atomicdata.dev/properties/emoji",classes:"https://atomicdata.dev/properties/classes",properties:"https://atomicdata.dev/properties/properties",instances:"https://atomicdata.dev/properties/instances"},ur={publicAgent:"https://atomicdata.dev/agents/publicAgent",displayStyleGrid:"https://atomicdata.dev/agents/publicAgent",numberFormats:{number:"https://atomicdata.dev/classes/NumberFormat/number",percentage:"https://atomicdata.dev/classes/NumberFormat/Percentage",currency:"https://atomicdata.dev/ontology/data-browser/number-format/vAikhI3z"},dateFormats:{localNumeric:"https://atomicdata.dev/classes/DateFormat/localNumeric",localLong:"https://atomicdata.dev/classes/DateFormat/localLong",localRelative:"https://atomicdata.dev/classes/DateFormat/localRelative"}},lr={properties:cr,endpoints:{import:"/import"},classes:{agent:"https://atomicdata.dev/classes/Agent",chatRoom:"https://atomicdata.dev/classes/ChatRoom",collection:"https://atomicdata.dev/classes/Collection",commit:"https://atomicdata.dev/classes/Commit",class:"https://atomicdata.dev/classes/Class",document:"https://atomicdata.dev/classes/Document",bookmark:"https://atomicdata.dev/class/Bookmark",elements:{paragraph:"https://atomicdata.dev/classes/elements/Paragraph"},error:"https://atomicdata.dev/classes/Error",property:"https://atomicdata.dev/classes/Property",datatype:"https://atomicdata.dev/classes/Datatype",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",invite:"https://atomicdata.dev/classes/Invite",file:"https://atomicdata.dev/classes/File",message:"https://atomicdata.dev/classes/Message",importer:"https://atomicdata.dev/classes/Importer",folder:"https://atomicdata.dev/classes/Folder",article:"https://atomicdata.dev/classes/Article",displayStyle:"https://atomicdata.dev/class/DisplayStyle",displayStyles:{grid:"https://atomicdata.dev/display-style/grid",list:"https://atomicdata.dev/display-style/list"},dateFormat:"https://atomicdata.dev/classes/DateFormat",numberFormat:"https://atomicdata.dev/classes/NumberFormat",constraintProperties:{rangeProperty:"https://atomicdata.dev/classes/RangeProperty",floatRangeProperty:"https://atomicdata.dev/classes/FloatRangeProperty",formattedNumber:"https://atomicdata.dev/classes/FormattedNumber",selectProperty:"https://atomicdata.dev/classes/SelectProperty",formattedDate:"https://atomicdata.dev/classes/FormattedDate"},table:"https://atomicdata.dev/classes/Table",tag:"https://atomicdata.dev/classes/Tag",ontology:"https://atomicdata.dev/class/ontology"},datatypes:{atomicUrl:"https://atomicdata.dev/datatypes/atomicURL",boolean:"https://atomicdata.dev/datatypes/boolean",date:"https://atomicdata.dev/datatypes/date",float:"https://atomicdata.dev/datatypes/float",integer:"https://atomicdata.dev/datatypes/integer",markdown:"https://atomicdata.dev/datatypes/markdown",resourceArray:"https://atomicdata.dev/datatypes/resourceArray",slug:"https://atomicdata.dev/datatypes/slug",string:"https://atomicdata.dev/datatypes/string",timestamp:"https://atomicdata.dev/datatypes/timestamp"},instances:ur},pr=function(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},hr=function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},dr=function(t){return this instanceof dr?(this.v=t,this):new dr(t)},fr=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yr=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},mr=function(){function t(t,e,r,o){void 0===o&&(o=!1),this.__internalObject=this,this.pages=new Map,this._totalMembers=0,this.store=t,this.server=e,this.params=r,o||(this._waitForReady=this.fetchPage(0)),this.clearPages=this.clearPages.bind(this)}return Object.defineProperty(t.prototype,"property",{get:function(){return this.params.property},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.params.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortBy",{get:function(){return this.params.sort_by},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortDesc",{get:function(){return!!this.params.sort_desc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageSize",{get:function(){return parseInt(this.params.page_size,10)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalMembers",{get:function(){return this._totalMembers},enumerable:!1,configurable:!0}),t.prototype.waitForReady=function(){return this._waitForReady},t.prototype.getMemberWithIndex=function(t){return pr(this,void 0,void 0,(function(){var e;return hr(this,(function(r){switch(r.label){case 0:if(t>=this.totalMembers)throw new Error("Index out of bounds");return e=Math.floor(t/this.pageSize),this.pages.has(e)?[3,2]:(this._waitForReady=this.fetchPage(e),[4,this._waitForReady]);case 1:r.sent(),r.label=2;case 2:return[2,this.pages.get(e).getArray(lr.properties.collection.members)[t%this.pageSize]]}}))}))},t.prototype.clearPages=function(){this.pages=new Map},t.prototype.refresh=function(){return pr(this,void 0,void 0,(function(){return hr(this,(function(t){return this.clearPages(),this._waitForReady=this.fetchPage(0),[2,this._waitForReady]}))}))},t.prototype.clone=function(){var e=new t(this.store,this.server,this.params);return e._totalMembers=this._totalMembers,e._waitForReady=this._waitForReady,e.pages=this.pages,e},t.prototype[Symbol.asyncIterator]=function(){return function(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=r.apply(t,e||[]),i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(t){n[t]&&(o[t]=function(e){return new Promise((function(r,o){i.push([t,e,r,o])>1||a(t,e)}))})}function a(t,e){try{(r=n[t](e)).value instanceof dr?Promise.resolve(r.value.v).then(c,u):l(i[0][2],r)}catch(t){l(i[0][3],t)}var r}function c(t){a("next",t)}function u(t){a("throw",t)}function l(t,e){t(e),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,(function(){var t;return hr(this,(function(e){switch(e.label){case 0:return[4,dr(this.waitForReady())];case 1:e.sent(),t=0,e.label=2;case 2:return t<this.totalMembers?[4,dr(this.getMemberWithIndex(t))]:[3,6];case 3:return[4,e.sent()];case 4:e.sent(),e.label=5;case 5:return t++,[3,2];case 6:return[2]}}))}))},t.prototype.getAllMembers=function(){var t,e,r,o;return pr(this,void 0,void 0,(function(){var n,i,s,a,c,u,l;return hr(this,(function(p){switch(p.label){case 0:n=this.params.page_size,this.params.page_size="1000",i=[],p.label=1;case 1:p.trys.push([1,6,7,12]),s=!0,a=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof fr?fr(t):t[Symbol.iterator](),e={},o("next"),o("throw"),o("return"),e[Symbol.asyncIterator]=function(){return this},e);function o(r){e[r]=t[r]&&function(e){return new Promise((function(o,n){!function(t,e,r,o){Promise.resolve(o).then((function(e){t({value:e,done:r})}),e)}(o,n,(e=t[r](e)).done,e.value)}))}}}(this),p.label=2;case 2:return[4,a.next()];case 3:if(c=p.sent(),t=c.done)return[3,5];o=c.value,s=!1;try{u=o,i.push(u)}finally{s=!0}p.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=p.sent(),e={error:l},[3,12];case 7:return p.trys.push([7,,10,11]),s||t||!(r=a.return)?[3,9]:[4,r.call(a)];case 8:p.sent(),p.label=9;case 9:return[3,11];case 10:if(e)throw e.error;return[7];case 11:return[7];case 12:return this.params.page_size=n,[2,i]}}))}))},t.prototype.buildSubject=function(t){var e,r,o=new URL("".concat(this.server,"/query"));try{for(var n=fr(Object.entries(this.params)),i=n.next();!i.done;i=n.next()){var s=yr(i.value,2),a=s[0],c=s[1];o.searchParams.set(a,c)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return o.searchParams.set("current_page","".concat(t)),o.toString()},t.prototype.fetchPage=function(t){return pr(this,void 0,void 0,(function(){var e,r,o;return hr(this,(function(n){switch(n.label){case 0:return e=this.buildSubject(t),[4,this.store.fetchResourceFromServer(e)];case 1:if(!(r=n.sent()))throw new Error("Invalid collection: resource does not exist");if(r.error)throw new Error("Invalid collection: resource has error: ".concat(r.error));if(this.pages.set(t,r),!Pe(o=r.get(lr.properties.collection.totalMembers)))throw new Error("Invalid collection: total-members is not a number");return this._totalMembers=o,[2]}}))}))},t}();!function(){function t(t,e){this.params={page_size:"30"},this.store=t,this.server=null!=e?e:new URL(t.getServerUrl()).origin}t.prototype.setProperty=function(t){return this.params.property=t,this},t.prototype.setValue=function(t){return this.params.value=t,this},t.prototype.setSortBy=function(t){return this.params.sort_by=t,this},t.prototype.setSortDesc=function(t){return this.params.sort_desc=t,this},t.prototype.setPageSize=function(t){return this.params.page_size="".concat(t),this},t.prototype.build=function(){return new mr(this.store,this.server,this.params)},t.prototype.buildAndFetch=function(){return t=this,e=void 0,o=function(){var t;return function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(e){switch(e.label){case 0:return[4,(t=this.build()).waitForReady()];case 1:return e.sent(),[2,t]}}))},new((r=void 0)||(r=Promise))((function(n,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}));var t,e,r,o}}(),function(){for(var t,e,r,s,a,c,u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];try{for(var p=o(u),h=p.next();!h.done;h=p.next()){var d=h.value;try{for(var f=(r=void 0,o(Object.entries(d.classes))),y=f.next();!y.done;y=f.next()){var m=n(y.value,2),v=m[0],b=m[1];i.set(b,v)}}catch(t){r={error:t}}finally{try{y&&!y.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}try{for(var g=(a=void 0,o(Object.entries(d.properties))),w=g.next();!w.done;w=g.next()){var S=n(w.value,2);v=S[0],b=S[1],i.set(b,v)}}catch(t){a={error:t}}finally{try{w&&!w.done&&(c=g.return)&&c.call(g)}finally{if(a)throw a.error}}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}}(a,c,u,{classes:{chatroom:"https://atomicdata.dev/classes/ChatRoom",document:"https://atomicdata.dev/classes/Document",bookmark:"https://atomicdata.dev/class/Bookmark",paragraph:"https://atomicdata.dev/classes/elements/Paragraph",message:"https://atomicdata.dev/classes/Message",importer:"https://atomicdata.dev/classes/Importer",folder:"https://atomicdata.dev/classes/Folder",article:"https://atomicdata.dev/classes/Article",displayStyle:"https://atomicdata.dev/class/DisplayStyle",dateFormat:"https://atomicdata.dev/classes/DateFormat",numberFormat:"https://atomicdata.dev/classes/NumberFormat",rangeProperty:"https://atomicdata.dev/classes/RangeProperty",floatRangeProperty:"https://atomicdata.dev/classes/FloatRangeProperty",formattedNumber:"https://atomicdata.dev/classes/FormattedNumber",selectProperty:"https://atomicdata.dev/classes/SelectProperty",formattedDate:"https://atomicdata.dev/classes/FormattedDate",table:"https://atomicdata.dev/classes/Table",tag:"https://atomicdata.dev/classes/Tag",currencyProperty:"https://atomicdata.dev/ontology/data-browser/class/currency-property"},properties:{subResources:"https://atomicdata.dev/properties/subresources",displayStyle:"https://atomicdata.dev/property/display-style",publishedAt:"https://atomicdata.dev/properties/published-at",elements:"https://atomicdata.dev/properties/documents/elements",messages:"https://atomicdata.dev/properties/messages",nextPage:"https://atomicdata.dev/properties/nextPage",replyTo:"https://atomicdata.dev/properties/replyTo",url:"https://atomicdata.dev/property/url",preview:"https://atomicdata.dev/property/preview",imageUrl:"https://atomicdata.dev/properties/imageUrl",max:"https://atomicdata.dev/properties/max",min:"https://atomicdata.dev/properties/min",maxFloat:"https://atomicdata.dev/properties/maxFloat",minFloat:"https://atomicdata.dev/properties/minFloat",numberFormatting:"https://atomicdata.dev/properties/numberFormatting",decimalPlaces:"https://atomicdata.dev/properties/decimalPlaces",dateFormat:"https://atomicdata.dev/properties/dateFormat",tableColumnWidths:"https://atomicdata.dev/properties/tableColumnWidths",customNodePositioning:"https://atomicdata.dev/properties/custom-node-positioning",color:"https://atomicdata.dev/properties/color",emoji:"https://atomicdata.dev/properties/emoji",tags:"https://atomicdata.dev/properties/tags",currency:"https://atomicdata.dev/ontology/data-browser/property/currency"}},{classes:{error:"https://atomicdata.dev/classes/Error",endpoint:"https://atomicdata.dev/classes/Endpoint",drive:"https://atomicdata.dev/classes/Drive",redirect:"https://atomicdata.dev/classes/Redirect",file:"https://atomicdata.dev/classes/File",invite:"https://atomicdata.dev/classes/Invite",endpointResponse:"https://atomicdata.dev/ontology/server/class/endpoint-response"},properties:{drives:"https://atomicdata.dev/properties/drives",results:"https://atomicdata.dev/properties/endpoint/results",property:"https://atomicdata.dev/properties/search/property",redirectAgent:"https://atomicdata.dev/properties/invite/redirectAgent",agent:"https://atomicdata.dev/properties/invite/agent",publicKey:"https://atomicdata.dev/properties/invite/publicKey",target:"https://atomicdata.dev/properties/invite/target",usagesLeft:"https://atomicdata.dev/properties/invite/usagesLeft",users:"https://atomicdata.dev/properties/invite/users",write:"https://atomicdata.dev/properties/invite/write",filename:"https://atomicdata.dev/properties/filename",filesize:"https://atomicdata.dev/properties/filesize",downloadUrl:"https://atomicdata.dev/properties/downloadURL",mimetype:"https://atomicdata.dev/properties/mimetype",attachments:"https://atomicdata.dev/properties/attachments",createdBy:"https://atomicdata.dev/properties/createdBy",checksum:"https://atomicdata.dev/properties/checksum",internalId:"https://atomicdata.dev/properties/internalId",children:"https://atomicdata.dev/properties/children",parameters:"https://atomicdata.dev/properties/endpoint/parameters",destination:"https://atomicdata.dev/properties/destination",status:"https://atomicdata.dev/ontology/server/property/status",responseMessage:"https://atomicdata.dev/ontology/server/property/response-message"}}),new Set}},i={};function s(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return n[t].call(r.exports,r,r.exports,s),r.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},s.a=(n,i,s)=>{var a;s&&((a=[]).d=-1);var c,u,l,p=new Set,h=n.exports,d=new Promise(((t,e)=>{l=e,u=t}));d[e]=h,d[t]=t=>(a&&t(a),p.forEach(t),d.catch((t=>{}))),n.exports=d,i((n=>{var i;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[t])return n;if(n.then){var i=[];i.d=0,n.then((t=>{s[e]=t,o(i)}),(t=>{s[r]=t,o(i)}));var s={};return s[t]=t=>t(i),s}}var a={};return a[t]=t=>{},a[e]=n,a})))(n);var s=()=>c.map((t=>{if(t[r])throw t[r];return t[e]})),u=new Promise((e=>{(i=()=>e(s)).r=0;var r=t=>t!==a&&!p.has(t)&&(p.add(t),t&&!t.d&&(i.r++,t.push(i)));c.map((e=>e[t](r)))}));return i.r?u:s()}),(t=>(t?l(d[r]=t):u(h),o(a)))),a&&a.d<0&&(a.d=0)},s.d=(t,e)=>{for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s(105)})();